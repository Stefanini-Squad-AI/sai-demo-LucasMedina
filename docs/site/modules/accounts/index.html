<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo de Cuentas - Gu√≠a de Desarrollo de Historias de Usuario</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background: #f5f7fa;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .section h2 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        .card h4 { color: #667eea; margin-bottom: 10px; }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
        }
        .complexity-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
        }
        .simple { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .complex { background: #f8d7da; color: #721c24; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th { background: #667eea; color: white; }
        .rule { background: #e3f2fd; padding: 15px; margin: 10px 0; border-left: 4px solid #2196f3; border-radius: 4px; }
        .us-example {
            background: #f3e5f5;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #9c27b0;
            border-radius: 4px;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        footer a { color: #667eea; text-decoration: none; font-weight: 600; }
        footer a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üì¶ M√≥dulo de Cuentas (Accounts)</h1>
            <p style="font-size: 1.2em; opacity: 0.95;">Gu√≠a de Desarrollo de Historias de Usuario</p>
            <p style="margin-top: 10px;"><strong>Prop√≥sito:</strong> Gesti√≥n completa del ciclo de vida de cuentas de tarjetas de cr√©dito, incluyendo visualizaci√≥n de informaci√≥n financiera y actualizaci√≥n transaccional de datos</p>
        </header>

        <section class="section">
            <h2>üìã Resumen del M√≥dulo</h2>
            <p><strong>Contexto de Negocio:</strong> Este m√≥dulo permite a representantes de servicio al cliente y administradores gestionar cuentas de tarjetas de cr√©dito, desde consultas de saldo hasta actualizaciones de l√≠mites y datos personales de clientes.</p>
            <p><strong>Responsabilidades Principales:</strong></p>
            <ul style="line-height: 2;">
                <li>B√∫squeda y visualizaci√≥n de cuentas por ID de 11 d√≠gitos</li>
                <li>Mostrar informaci√≥n financiera (l√≠mites, balances, ciclos)</li>
                <li>Actualizaci√≥n transaccional de datos de cuenta y cliente</li>
                <li>Protecci√≥n de datos sensibles (SSN, n√∫meros de tarjeta)</li>
                <li>Validaciones de negocio en tiempo real</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de Desarrollo de Historias de Usuario</h2>
            
            <h3>üìù Templates de US Espec√≠ficos</h3>
            <div class="grid">
                <div class="card">
                    <h4>Visualizaci√≥n de Cuentas</h4>
                    <p><strong>Patr√≥n:</strong> Como [representante de servicio], quiero [consultar datos] para [brindar soporte]</p>
                    <div class="us-example">
                        <strong>Ejemplo:</strong> Como representante de servicio al cliente, quiero buscar una cuenta por su ID de 11 d√≠gitos para visualizar el estado financiero completo y responder consultas del titular
                    </div>
                </div>
                
                <div class="card">
                    <h4>Actualizaci√≥n de Cuentas</h4>
                    <p><strong>Patr√≥n:</strong> Como [administrador], quiero [modificar par√°metros] para [ajustar condiciones]</p>
                    <div class="us-example">
                        <strong>Ejemplo:</strong> Como administrador de cuentas, quiero actualizar el l√≠mite de cr√©dito para reflejar la mejora en el puntaje FICO del cliente
                    </div>
                </div>
                
                <div class="card">
                    <h4>Validaci√≥n y Seguridad</h4>
                    <p><strong>Patr√≥n:</strong> Como [usuario], quiero [validaciones autom√°ticas] para [prevenir errores]</p>
                    <div class="us-example">
                        <strong>Ejemplo:</strong> Como oficial de cumplimiento, quiero que el SSN siempre se muestre enmascarado para cumplir con regulaciones PCI-DSS
                    </div>
                </div>
            </div>

            <h3>‚ö° Factores de Aceleraci√≥n de Desarrollo</h3>
            <ul style="line-height: 2;">
                <li><strong>useAccountView Hook:</strong> Hook reutilizable que encapsula b√∫squeda y manejo de estado. Acelera desarrollo al evitar reimplementar l√≥gica de carga y errores.</li>
                <li><strong>useAccountUpdate Hook:</strong> Detecta cambios automticamente comparando estado original vs actual. Reduce complejidad de formularios de edici√≥n.</li>
                <li><strong>AccountValidationService (Backend):</strong> Validaciones centralizadas evitan c√≥digo duplicado. Nuevas validaciones se agregan una sola vez.</li>
                <li><strong>Material-UI Components:</strong> TextField, Card, Button preconstruidos reducen tiempo de UI en 60%.</li>
                <li><strong>API RESTful Documentada:</strong> 4 endpoints bien definidos facilitan integraci√≥n frontend-backend en 1-2 d√≠as.</li>
            </ul>

            <h3>üìä Gu√≠as de Complejidad</h3>
            <div>
                <span class="complexity-badge simple">Simple (1-2 pts)</span>
                <span class="complexity-badge medium">Medio (3-5 pts)</span>
                <span class="complexity-badge complex">Complejo (5-8 pts)</span>
            </div>
            <ul style="margin-top: 20px; line-height: 2;">
                <li><strong>Simple (1-2 pts):</strong> Agregar campo de solo lectura en AccountViewScreen, agregar validaci√≥n regex existente</li>
                <li><strong>Medio (3-5 pts):</strong> Implementar nueva validaci√≥n de negocio, agregar campo editable con validaci√≥n client/server</li>
                <li><strong>Complejo (5-8 pts):</strong> Integrar con sistema externo de scoring, implementar auditor√≠a completa de cambios</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundaci√≥n T√©cnica</h2>
            
            <h3>üèóÔ∏è Componentes Clave</h3>
            <div class="grid">
                <div class="card">
                    <h4>AccountViewScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Pantalla de b√∫squeda y visualizaci√≥n de cuentas con 4 tarjetas de informaci√≥n</p>
                    <p><strong>Reusabilidad:</strong> Funciones de mascarado (maskSSN, maskCard) exportables para otros m√≥dulos</p>
                </div>
                <div class="card">
                    <h4>AccountUpdateScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Edici√≥n con modo toggle, confirmaci√≥n de guardado, detecci√≥n de cambios</p>
                    <p><strong>Reusabilidad:</strong> Patr√≥n de toggle edit mode aplicable a cualquier formulario</p>
                </div>
                <div class="card">
                    <h4>useAccountView.ts</h4>
                    <p><strong>Responsabilidad:</strong> Hook para b√∫squeda con validaci√≥n inline y manejo de estados (loading/error/data)</p>
                    <p><strong>Reusabilidad:</strong> Plantilla para crear hooks de b√∫squeda en otros m√≥dulos</p>
                </div>
                <div class="card">
                    <h4>useAccountUpdate.ts</h4>
                    <p><strong>Responsabilidad:</strong> Hook para actualizaci√≥n con detecci√≥n autom√°tica de cambios</p>
                    <p><strong>Reusabilidad:</strong> L√≥gica de comparaci√≥n JSON reutilizable</p>
                </div>
                <div class="card">
                    <h4>AccountViewService.java</h4>
                    <p><strong>Responsabilidad:</strong> B√∫squeda multi-entidad (CardXref ‚Üí Account ‚Üí Customer) con enmascarado de SSN</p>
                    <p><strong>Reusabilidad:</strong> Patr√≥n de lectura de 3 entidades relacionadas</p>
                </div>
                <div class="card">
                    <h4>AccountUpdateService.java</h4>
                    <p><strong>Responsabilidad:</strong> Actualizaci√≥n transaccional at√≥mica de Account + Customer</p>
                    <p><strong>Reusabilidad:</strong> Patr√≥n @Transactional para operaciones multi-entidad</p>
                </div>
                <div class="card">
                    <h4>AccountValidationService.java</h4>
                    <p><strong>Responsabilidad:</strong> Validaciones de negocio centralizadas (FICO, ZIP, nombres, etc.)</p>
                    <p><strong>Reusabilidad:</strong> M√©todos de validaci√≥n reutilizables (isValidAccountId, validateYesNo, etc.)</p>
                </div>
            </div>

            <h3>üîó Dependencias</h3>
            <ul style="line-height: 2;">
                <li><strong>Account Entity:</strong> JPA Entity con 11 campos financieros y operativos</li>
                <li><strong>Customer Entity:</strong> JPA Entity con 14 campos personales y de contacto</li>
                <li><strong>CardXrefRecord:</strong> Tabla de relaci√≥n Account-Customer-Card</li>
                <li><strong>Material-UI:</strong> TextField, Card, Button, IconButton, Snackbar</li>
                <li><strong>Redux Toolkit:</strong> Gesti√≥n de estado global (opcional para este m√≥dulo)</li>
            </ul>

            <h3>üåê Interfaces P√∫blicas (APIs)</h3>
            <pre><code>GET  /api/account-view?accountId={id}
     ‚Üí Buscar y obtener cuenta completa con datos de cliente
     ‚Üí Response: AccountViewResponseDto (JSON)

GET  /api/account-view/initialize
     ‚Üí Inicializar pantalla con metadata del sistema
     ‚Üí Response: AccountViewResponseDto con fecha/hora/transactionId

GET  /api/accounts/{accountId}
     ‚Üí Obtener datos de cuenta para formulario de edici√≥n
     ‚Üí Response: AccountUpdateRequestDto (JSON)

PUT  /api/accounts/{accountId}
     ‚Üí Actualizar cuenta y cliente (transaccional)
     ‚Üí Body: AccountUpdateRequestDto
     ‚Üí Response: Map&lt;String, String&gt; con mensaje de √©xito</code></pre>

            <h3>üìä Modelos de Datos (Simplificado)</h3>
            <pre><code>// TypeScript Frontend
interface AccountViewResponse {
  accountId: number;
  accountStatus: string;  // Y/N
  creditLimit: number;
  currentBalance: number;
  customerId: number;
  customerSsn: string;    // Enmascarado "XXX-XX-XXXX"
  ficoScore: number;      // 300-850
  firstName: string;
  lastName: string;
  zipCode: string;
  // ... otros 20+ campos
}

// Java Backend
@Entity
public class Account {
  @Id private Long accountId;      // 11 d√≠gitos
  private String activeStatus;     // Y/N
  private BigDecimal creditLimit;
  private BigDecimal currentBalance;
  private LocalDate openDate;
  // ... otros campos
}

@Entity
public class Customer {
  @Id private Long customerId;     // 9 d√≠gitos
  private String firstName;
  private String lastName;
  private String socialSecurityNumber;  // 9 d√≠gitos
  private Integer ficoScore;            // 300-850
  private String zipCode;
  // ... otros campos
}</code></pre>
        </section>

        <section class="section">
            <h2>üìã Reglas de Negocio</h2>
            
            <h3>Identificaci√≥n y B√∫squeda</h3>
            <div class="rule">
                <strong>RN-001:</strong> El Account ID debe ser exactamente de 11 d√≠gitos num√©ricos
            </div>
            <div class="rule">
                <strong>RN-002:</strong> El Account ID no puede ser todo ceros (00000000000)
            </div>
            <div class="rule">
                <strong>RN-003:</strong> La b√∫squeda valida existencia en: CardXrefRecord ‚Üí Account ‚Üí Customer
            </div>
            
            <h3>Seguridad y Privacidad</h3>
            <div class="rule">
                <strong>RN-006:</strong> El SSN se muestra enmascarado: <code>***-**-XXXX</code> (solo √∫ltimos 4 d√≠gitos)
            </div>
            <div class="rule">
                <strong>RN-007:</strong> El n√∫mero de tarjeta se enmascara: <code>****-****-****-XXXX</code>
            </div>
            
            <h3>Validaciones Cr√≠ticas</h3>
            <div class="rule">
                <strong>RN-009:</strong> Active Status solo acepta 'Y' (activo) o 'N' (inactivo)
            </div>
            <div class="rule">
                <strong>RN-012:</strong> FICO Score debe estar en rango 300-850
            </div>
            <div class="rule">
                <strong>RN-015:</strong> ZIP Code formato: <code>^\d{5}(-\d{4})?$</code>
            </div>
            
            <h3>Transaccionalidad</h3>
            <div class="rule">
                <strong>RN-018:</strong> Actualizaci√≥n de Account y Customer es at√≥mica (todo o nada)
            </div>
            <div class="rule">
                <strong>RN-021:</strong> Se hace "READ FOR UPDATE" (lock pesimista) antes de actualizar
            </div>
        </section>

        <section class="section">
            <h2>üéØ Patrones de Criterios de Aceptaci√≥n</h2>
            <div class="grid">
                <div class="card">
                    <h4>Autenticaci√≥n</h4>
                    <p><strong>Dado</strong> que soy usuario con rol "Customer Service"<br>
                    <strong>Cuando</strong> accedo al m√≥dulo<br>
                    <strong>Entonces</strong> puedo ver pero no editar cuentas</p>
                </div>
                <div class="card">
                    <h4>Validaci√≥n</h4>
                    <p><strong>Dado</strong> que ingreso Account ID<br>
                    <strong>Cuando</strong> tiene menos de 11 d√≠gitos<br>
                    <strong>Entonces</strong> muestra error "Must be 11 digits"</p>
                </div>
                <div class="card">
                    <h4>Rendimiento</h4>
                    <p><strong>Dado</strong> que busco una cuenta<br>
                    <strong>Cuando</strong> el ID existe<br>
                    <strong>Entonces</strong> resultados en &lt; 500ms</p>
                </div>
                <div class="card">
                    <h4>Manejo de Errores</h4>
                    <p><strong>Dado</strong> que busco cuenta inexistente<br>
                    <strong>Cuando</strong> no est√° en CardXref<br>
                    <strong>Entonces</strong> muestra "Account not found in Cross ref file"</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>‚ö° Consideraciones de Rendimiento</h2>
            <ul style="line-height: 2;">
                <li><strong>Tiempo de Respuesta:</strong> &lt; 500ms (P95) para b√∫squedas</li>
                <li><strong>Throughput:</strong> Soporta 100 b√∫squedas concurrentes/segundo</li>
                <li><strong>Uso de Memoria:</strong> &lt; 50MB por sesi√≥n de usuario</li>
                <li><strong>Estrategia de Cach√©:</strong> Sin cach√© actualmente (queries directas a PostgreSQL)</li>
                <li><strong>√çndices DB:</strong> Requeridos en accountId, customerId, cardNumber</li>
            </ul>
        </section>

        <section class="section">
            <h2>üö® Riesgos de Desarrollo y Mitigaciones</h2>
            <div class="grid">
                <div class="card">
                    <h4>‚ö†Ô∏è Performance en B√∫squedas</h4>
                    <p><strong>Riesgo:</strong> B√∫squeda secuencial en 3 tablas puede degradarse con alto volumen</p>
                    <p><strong>Mitigaci√≥n:</strong> Implementar √≠ndices en accountId y customerId; considerar cach√© Redis para cuentas frecuentes</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Falta de i18n</h4>
                    <p><strong>Riesgo:</strong> Mensajes hardcodeados en ingl√©s no cumplen requisito de espa√±ol</p>
                    <p><strong>Mitigaci√≥n:</strong> Implementar react-i18next antes de nuevas funcionalidades (estimado 5 puntos)</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Sin Auditor√≠a de Cambios</h4>
                    <p><strong>Riesgo:</strong> No hay trazabilidad de qui√©n modific√≥ qu√© valores</p>
                    <p><strong>Mitigaci√≥n:</strong> Implementar Audit Trail con Spring Data Envers (5 puntos)</p>
                </div>
                <div class="card">
                    <h4>‚ö†Ô∏è Validaciones COBOL Comentadas</h4>
                    <p><strong>Riesgo:</strong> Validaci√≥n de SSN est√° comentada en c√≥digo migrado</p>
                    <p><strong>Mitigaci√≥n:</strong> Revisar y habilitar o reemplazar con validaciones modernas</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>üìö Ejemplos de C√≥digo</h2>
            
            <h3>Patr√≥n de Implementaci√≥n: Hook de B√∫squeda</h3>
            <pre><code>// useAccountView.ts - Patr√≥n reutilizable
export function useAccountView() {
  const [data, setData] = useState&lt;AccountViewResponse | null&gt;(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState&lt;string | null&gt;(null);

  const searchAccount = async (request: AccountViewRequest) =&gt; {
    setLoading(true);
    try {
      const accountIdNum = parseInt(request.accountId);
      if (isNaN(accountIdNum) || accountIdNum === 0) {
        throw new Error("Account must be non-zero 11 digit number");
      }
      
      const response = await api.get&lt;AccountViewResponse&gt;(
        `/account-view?accountId=${request.accountId.padStart(11, "0")}`
      );
      setData(response.data);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return { data, loading, error, searchAccount };
}</code></pre>

            <h3>Patr√≥n Backend: Servicio Transaccional</h3>
            <pre><code>// AccountUpdateService.java
@Service
public class AccountUpdateService {
  
  @Transactional  // ‚Üê Clave: garantiza atomicidad
  public Map&lt;String, String&gt; updateAccountAndCustomer(
      Long accountId, AccountUpdateRequestDto request) {
    
    // Leer con lock
    Account account = accountRepository.findById(accountId)
        .orElseThrow(() -&gt; new ResourceNotFoundException("Account not found"));
    Customer customer = customerRepository.findByAccountId(accountId)
        .orElseThrow(() -&gt; new ResourceNotFoundException("Customer not found"));
    
    // Validar
    List&lt;String&gt; errors = validationService.validateAccountUpdate(request);
    if (!errors.isEmpty()) {
      throw new ValidationException(String.join(", ", errors));
    }
    
    // Actualizar
    updateAccountFromRequest(account, request);
    updateCustomerFromRequest(customer, request);
    
    // Guardar (si falla uno, rollback autom√°tico)
    accountRepository.save(account);
    customerRepository.save(customer);
    
    return Map.of("message", "Account updated successfully");
  }
}</code></pre>
        </section>

        <section class="section">
            <h2>üìä Tabla de Validaciones</h2>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Validaci√≥n</th>
                        <th>Regla</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Account ID</td><td><code>^\d{11}$</code></td><td>11 d√≠gitos, no cero</td></tr>
                    <tr><td>Status</td><td>Dropdown</td><td>Y (Activo) o N (Inactivo)</td></tr>
                    <tr><td>Credit Limit</td><td>Num√©rico</td><td>Positivo, obligatorio</td></tr>
                    <tr><td>FICO Score</td><td>300-850</td><td>Rango est√°ndar industria</td></tr>
                    <tr><td>ZIP Code</td><td><code>^\d{5}(-\d{4})?$</code></td><td>Formato US ZIP</td></tr>
                    <tr><td>State</td><td>Alfabtico</td><td>2 caracteres</td></tr>
                    <tr><td>First/Last Name</td><td>Alfab√©tico</td><td>Solo letras, obligatorio</td></tr>
                    <tr><td>SSN</td><td>Enmascarado</td><td>***-**-XXXX en vista</td></tr>
                </tbody>
            </table>
        </section>

        <footer>
            <p><a href="../../index.html">‚Üê Volver al √çndice de M√≥dulos</a></p>
            <p><a href="../../../system-overview.md">üè† Volver al System Overview</a></p>
            <p style="color: #666; margin-top: 15px;"><em>√öltima actualizaci√≥n: 2026-01-21 | Precisi√≥n del m√≥dulo: 95%</em></p>
        </footer>
    </div>
</body>
</html>
