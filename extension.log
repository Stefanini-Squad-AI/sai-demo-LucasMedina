2025-10-13T16:54:57.803Z - Iniciando parseStructureFromCode con parser mejorado
e COTRN02 (Transaction Add) y la estructura React existente, voy a crear la migraci贸n completa del componente de agregar transacciones.

```json
{
  "app/types/transaction.ts": "// app/types/transaction.ts\nexport interface TransactionAddRequest {\n  // Campos de identificaci贸n - uno de los dos debe estar presente\n  accountId?: string;\n  cardNumber?: string;\n  \n  // Datos de la transacci贸n\n  transactionTypeCode: string;\n  transactionCategoryCode: string;\n  transactionSource: string;\n  transactionDescription: string;\n  transactionAmount: string; // String para manejo de formato en frontend\n  originalDate: string; // YYYY-MM-DD format\n  processDate: string; // YYYY-MM-DD format\n  \n  // Datos del comerciante\n  merchantId: string;\n  merchantName: string;\n  merchantCity: string;\n  merchantZip: string;\n  \n  // Confirmaci贸n\n  confirmation: 'Y' | 'N' | '';\n}\n\nexport interface TransactionAddResponse {\n  transactionId?: string;\n  message: string;\n  success: boolean;\n}\n\nexport interface TransactionAddState {\n  formData: TransactionAddRequest;\n  validationErrors: Record<string, string>;\n  isSubmitting: boolean;\n  lastTransactionData?: TransactionAddRequest;\n}\n\nexport interface TransactionValidationResult {\n  isValid: boolean;\n  errors: Record<string, string>;\n}\n\n// Tipos para el 煤ltimo registro copiado\nexport interface LastTransactionData {\n  transactionTypeCode: string;\n  transactionCategoryCode: string;\n  transactionSource: string;\n  transactionDescription: string;\n  transactionAmount: string;\n  originalDate: string;\n  processDate: string;\n  merchantId: string;\n  merchantName: string;\n  merchantCity: string;\n  merchantZip: string;\n}",
  
  "app/hooks/useTransactionAdd.ts": "// app/hooks/useTransactionAdd.ts\nimport { useState, useCallback, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useMutation } from './useApi';\nimport { apiClient } from '~/services/api';\nimport type { \n  TransactionAddRequest, \n  TransactionAddResponse,\n  TransactionAddState,\n  TransactionValidationResult\n} from '~/types/transaction';\n\ninterface UseTransactionAddOptions {\n  onError?: (error: string) => void;\n  onSuccess?: (data: TransactionAddResponse) => void;\n}\n\ninterface LocationState {\n  cardNumber?: string;\n  accountId?: string;\n  fromList?: boolean;\n}\n\nexport function useTransactionAdd(options: UseTransactionAddOptions = {}) {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const state = location.state as LocationState;\n  \n  const hasAutoFilled = useRef(false);\n  \n  const [transactionState, setTransactionState] = useState<TransactionAddState>({\n    formData: {\n      accountId: state?.accountId || '',\n      cardNumber: state?.cardNumber || '',\n      transactionTypeCode: '',\n      transactionCategoryCode: '',\n      transactionSource: '',\n      transactionDescription: '',\n      transactionAmount: '',\n      originalDate: '',\n      processDate: '',\n      merchantId: '',\n      merchantName: '',\n      merchantCity: '',\n      merchantZip: '',\n      confirmation: '',\n    },\n    validationErrors: {},\n    isSubmitting: false,\n  });\n\n  // Mutation para agregar transacci贸n\n  const { mutate: addTransaction, loading: addLoading, error: addError } = useMutation(\n    async (request: TransactionAddRequest) => {\n      // Convertir datos para el backend\n      const backendRequest = {\n        accountId: request.accountId || undefined,\n        cardNumber: request.cardNumber || undefined,\n        transactionTypeCode: request.transactionTypeCode,\n        transactionCategoryCode: request.transactionCategoryCode,\n        transactionSource: request.transactionSource,\n        transactionDescription: request.transactionDescription,\n        transactionAmount: parseFloat(request.transactionAmount),\n        originalDate: new Date(request.originalDate + 'T00:00:00').toISOString(),\n        processDate: new Date(request.processDate + 'T00:00:00').toISOString(),\n        merchantId: request.merchantId,\n        merchantName: request.merchantName,\n        merchantCity: request.merchantCity,\n        merchantZip: request.merchantZip,\n        confirmation: request.confirmation,\n      };\n      \n      return apiClient.post<TransactionAddResponse>('/transactions', backendRequest);\n    },\n    {\n      onSuccess: (data: TransactionAddResponse) => {\n        if (data.success) {\n          // Limpiar formulario despu茅s del 茅xito\n          setTransactionState(prev => ({\n            ...prev,\n            formData: {\n              accountId: '',\n              cardNumber: '',\n              transactionTypeCode: '',\n              transactionCategoryCode: '',\n              transactionSource: '',\n              transactionDescription: '',\n              transactionAmount: '',\n              originalDate: '',\n              processDate: '',\n              merchantId: '',\n              merchantName: '',\n              merchantCity: '',\n              merchantZip: '',\n              confirmation: '',\n            },\n            validationErrors: {},\n          }));\n          options.onSuccess?.(data);\n        } else {\n          options.onError?.(data.message);\n        }\n      },\n      onError: (error: string) => {\n        options.onError?.(error);\n      },\n    }\n  );\n\n  // Mutation para obtener 煤ltima transacci贸n (F5 functionality)\n  const { mutate: getLastTransaction, loading: lastTranLoading } = useMutation(\n    async (request: { accountId?: string; cardNumber?: string }) => {\n      const params = new URLSearchParams();\n      if (request.accountId) params.append('accountId', request.accountId);\n      if (request.cardNumber) params.append('cardNumber', request.cardNumber);\n      \n      return apiClient.get<TransactionAddRequest>(`/transactions/last?${params.toString()}`);\n    },\n    {\n      onSuccess: (data: TransactionAddRequest) => {\n        setTransactionState(prev => ({\n          ...prev,\n          formData: {\n            ...prev.formData,\n            transactionTypeCode: data.transactionTypeCode,\n            transactionCategoryCode: data.transactionCategoryCode,\n            transactionSource: data.transactionSource,\n            transactionDescription: data.transactionDescription,\n            transactionAmount: data.transactionAmount,\n            originalDate: data.originalDate,\n            processDate: data.processDate,\n            merchantId: data.merchantId,\n            merchantName: data.merchantName,\n            merchantCity: data.merchantCity,\n            merchantZip: data.merchantZip,\n          },\n          lastTransactionData: data,\n        }));\n      },\n      onError: (error: string) => {\n        options.onError?.(error);\n      },\n    }\n  );\n\n  // Auto-llenar campos si viene de otra pantalla\n  const handleAutoFill = useCallback(() => {\n    if ((state?.accountId || state?.cardNumber) && !hasAutoFilled.current) {\n      hasAutoFilled.current = true;\n      setTransactionState(prev => ({\n        ...prev,\n        formData: {\n          ...prev.formData,\n          accountId: state.accountId || '',\n          cardNumber: state.cardNumber || '',\n        },\n      }));\n    }\n  }, [state]);\n\n  // Validaciones como en el COBOL original\n  const validateForm = useCallback((): TransactionValidationResult => {\n    const errors: Record<string, string> = {};\n    const { formData } = transactionState;\n\n    // Validar Account ID o Card Number (uno debe estar presente)\n    if (!formData.accountId && !formData.cardNumber) {\n      errors.accountId = 'Account or Card Number must be entered...';\n    }\n\n    if (formData.accountId) {\n      if (!/^\\d{11}$/.test(formData.accountId) || formData.accountId === '00000000000') {\n        errors.accountId = 'Account ID must be Numeric...';\n      }\n    }\n\n    if (formData.cardNumber) {\n      if (!/^\\d{16}$/.test(formData.cardNumber)) {\n        errors.cardNumber = 'Card Number must be Numeric...';\n      }\n    }\n\n    // Validar campos obligatorios\n    if (!formData.transactionTypeCode) {\n      errors.transactionTypeCode = 'Type CD can NOT be empty...';\n    } else if (!/^\\d{1,2}$/.test(formData.transactionTypeCode)) {\n      errors.transactionTypeCode = 'Type CD must be Numeric...';\n    }\n\n    if (!formData.transactionCategoryCode) {\n      errors.transactionCategoryCode = 'Category CD can NOT be empty...';\n    } else if (!/^\\d{1,4}$/.test(formData.transactionCategoryCode)) {\n      errors.transactionCategoryCode = 'Category CD must be Numeric...';\n    }\n\n    if (!formData.transactionSource) {\n      errors.transactionSource = 'Source can NOT be empty...';\n    }\n\n    if (!formData.transactionDescription) {\n      errors.transactionDescription = 'Description can NOT be empty...';\n    }\n\n    if (!formData.transactionAmount) {\n      errors.transactionAmount = 'Amount can NOT be empty...';\n    } else {\n      // Validar formato de monto (-99999999.99)\n      const amountRegex = /^[+-]?\\d{1,8}(\\.\\d{1,2})?$/;\n      if (!amountRegex.test(formData.transactionAmount)) {\n        errors.transactionAmount = 'Amount should be in format -99999999.99';\n      }\n    }\n\n    if (!formData.originalDate) {\n      errors.originalDate = 'Orig Date can NOT be empty...';\n    } else {\n      // Validar formato YYYY-MM-DD\n      const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n      if (!dateRegex.test(formData.originalDate)) {\n        errors.originalDate = 'Orig Date should be in format YYYY-MM-DD';\n      } else {\n        // Validar que sea una fecha v谩lida\n        const date = new Date(formData.originalDate);\n        if (isNaN(date.getTime())) {\n          errors.originalDate = 'Orig Date - Not a valid date...';\n        }\n      }\n    }\n\n    if (!formData.processDate) {\n      errors.processDate = 'Proc Date can NOT be empty...';\n    } else {\n      const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n      if (!dateRegex.test(formData.processDate)) {\n        errors.processDate = 'Proc Date should be in format YYYY-MM-DD';\n      } else {\n        const date = new Date(formData.processDate);\n        if (isNaN(date.getTime())) {\n          errors.processDate = 'Proc Date - Not a valid date...';\n        }\n      }\n    }\n\n    if (!formData.merchantId) {\n      errors.merchantId = 'Merchant ID can NOT be empty...';\n    } else if (!/^\\d+$/.test(formData.merchantId)) {\n      errors.merchantId = 'Merchant ID must be Numeric...';\n    }\n\n    if (!formData.merchantName) {\n      errors.merchantName = 'Merchant Name can NOT be empty...';\n    }\n\n    if (!formData.merchantCity) {\n      errors.merchantCity = 'Merchant City can NOT be empty...';\n    }\n\n    if (!formData.merchantZip) {\n      errors.merchantZip = 'Merchant Zip can NOT be empty...';\n    }\n\n    // Validar confirmaci贸n\n    if (!formData.confirmation) {\n      errors.confirmation = 'Confirm to add this transaction...';\n    } else if (!['Y', 'N'].includes(formData.confirmation.toUpperCase())) {\n      errors.confirmation = 'Invalid value. Valid values are (Y/N)...';\n    }\n\n    setTransactionState(prev => ({ ...prev, validationErrors: errors }));\n    return { isValid: Object.keys(errors).length === 0, errors };\n  }, [transactionState]);\n\n  // Manejar cambios en los campos\n  const handleFieldChange = useCallback((field: keyof TransactionAddRequest, value: string) => {\n    setTransactionState(prev => ({\n      ...prev,\n      formData: { ...prev.formData, [field]: value },\n      validationErrors: { ...prev.validationErrors, [field]: '' }, // Limpiar error del campo\n    }));\n  }, []);\n\n  // Manejar env铆o del formulario\n  const handleSubmit = useCallback(async () => {\n    const validation = validateForm();\n    \n    if (!validation.isValid) {\n      return;\n    }\n\n    if (transactionState.formData.confirmation.toUpperCase() !== 'Y') {\n      setTransactionState(prev => ({\n        ...prev,\n        validationErrors: { confirmation: 'Confirm to add this transaction...' },\n      }));\n      return;\n    }\n\n    await addTransaction(transactionState.formData);\n  }, [transactionState.formData, validateForm, addTransaction]);\n\n  // Copiar 煤ltima transacci贸n (F5)\n  const handleCopyLastTransaction = useCallback(async () => {\n    const { accountId, cardNumber } = transactionState.formData;\n    \n    if (!accountId && !cardNumber) {\n      setTransactionState(prev => ({\n        ...prev,\n        validationErrors: { accountId: 'Account or Card Number must be entered...' },\n      }));\n      return;\n    }\n\n    await getLastTransaction({ accountId, cardNumber });\n  }, [transactionState.formData, getLastTransaction]);\n\n  // Limpiar formulario (F4)\n  const handleClearForm = useCallback(() => {\n    setTransactionState({\n      formData: {\n        accountId: '',\n        cardNumber: '',\n        transactionTypeCode: '',\n        transactionCategoryCode: '',\n        transactionSource: '',\n        transactionDescription: '',\n        transactionAmount: '',\n        originalDate: '',\n        processDate: '',\n        merchantId: '',\n        merchantName: '',\n        merchantCity: '',\n        merchantZip: '',\n        confirmation: '',\n      },\n      validationErrors: {},\n      isSubmitting: false,\n    });\n  }, []);\n\n  // Salir (F3)\n  const handleExit = useCallback(() => {\n    navigate('/menu/main');\n  }, [navigate]);\n\n  return {\n    // Estado\n    transactionState,\n    loading: addLoading || lastTranLoading,\n    error: addError,\n    \n    // Acciones\n    handleAutoFill,\n    handleFieldChange,\n    handleSubmit,\n    handleCopyLastTransaction,\n    handleClearForm,\n    handleExit,\n    \n    // Utilidades\n    validateForm,\n    isFromList: !!state?.fromList,\n  };\n}",
  
  "app/components/transaction/TransactionAddScreen.tsx": "// app/components/transaction/TransactionAddScreen.tsx\nimport React, { useEffect } from 'react';\nimport {\n  Container,\n  Box,\n  Paper,\n  Typography,\n  TextField,\n  Button,\n  Grid,\n  Alert,\n  Divider,\n  Stack,\n  useTheme,\n  alpha,\n  InputAdornment,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n} from '@mui/material';\nimport {\n  Add as AddIcon,\n  Clear as ClearIcon,\n  FileCopy as CopyIcon,\n  ExitToApp as ExitIcon,\n  AccountBalance,\n  CreditCard,\n  Category,\n  Source,\n  Description,\n  AttachMoney,\n  DateRange,\n  Store,\n  LocationCity,\n  PostAdd,\n  CheckCircle,\n} from '@mui/icons-material';\nimport { SystemHeader } from '~/components/layout/SystemHeader';\nimport type { TransactionAddRequest } from '~/types/transaction';\n\ninterface TransactionAddScreenProps {\n  formData: TransactionAddRequest;\n  validationErrors: Record<string, string>;\n  loading: boolean;\n  error?: string | null;\n  successMessage?: string | null;\n  onFieldChange: (field: keyof TransactionAddRequest, value: string) => void;\n  onSubmit: () => void;\n  onCopyLastTransaction: () => void;\n  onClearForm: () => void;\n  onExit: () => void;\n}\n\nexport function TransactionAddScreen({\n  formData,\n  validationErrors,\n  loading,\n  error,\n  successMessage,\n  onFieldChange,\n  onSubmit,\n  onCopyLastTransaction,\n  onClearForm,\n  onExit,\n}: TransactionAddScreenProps) {\n  const theme = useTheme();\n\n  // Auto-focus en el primer campo\n  useEffect(() => {\n    const firstInput = document.querySelector('input[name=\"accountId\"]') as HTMLInputElement;\n    if (firstInput && !formData.accountId && !formData.cardNumber) {\n      firstInput.focus();\n    }\n  }, [formData.accountId, formData.cardNumber]);\n\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (event.key === 'F3' || event.key === 'Escape') {\n      event.preventDefault();\n      onExit();\n    } else if (event.key === 'F4') {\n      event.preventDefault();\n      onClearForm();\n    } else if (event.key === 'F5') {\n      event.preventDefault();\n      onCopyLastTransaction();\n    }\n  };\n\n  const handleSubmit = (event: React.FormEvent) => {\n    event.preventDefault();\n    onSubmit();\n  };\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ py: 3 }}>\n      <Box onKeyDown={handleKeyDown} tabIndex={-1}>\n        <SystemHeader\n          transactionId=\"CT02\"\n          programName=\"COTRN02C\"\n          title=\"Add Transaction\"\n        />\n\n        <Paper\n          elevation={2}\n          sx={{\n            borderRadius: 3,\n            overflow: 'hidden',\n            background: `linear-gradient(145deg, ${alpha(theme.palette.background.paper, 0.9)}, ${alpha(theme.palette.background.default, 0.1)})`,\n          }}\n        >\n          {/* Header */}\n          <Box\n            sx={{\n              p: 3,\n              textAlign: 'center',\n              background: `linear-gradient(135deg, ${theme.palette.primary.main}, ${theme.palette.secondary.main})`,\n              color: 'white',\n            }}\n          >\n            <AddIcon sx={{ fontSize: 48, mb: 1 }} />\n            <Typography variant=\"h4\" fontWeight={600}>\n              Add Transaction\n            </Typography>\n          </Box>\n\n          {/* Formulario */}\n          <Box sx={{ p: 4 }}>\n            <Box component=\"form\" onSubmit={handleSubmit}>\n              {/* Secci贸n de Identificaci贸n */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Account/Card Identification\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={5}>\n                  <TextField\n                    name=\"accountId\"\n                    label=\"Enter Acct #\"\n                    value={formData.accountId}\n                    onChange={(e) => onFieldChange('accountId', e.target.value)}\n                    error={!!validationErrors.accountId}\n                    helperText={validationErrors.accountId || '11 digits'}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 11 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <AccountBalance color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={2} sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                  <Typography variant=\"body1\" color=\"text.secondary\">\n                    (or)\n                  </Typography>\n                </Grid>\n                \n                <Grid item xs={12} md={5}>\n                  <TextField\n                    name=\"cardNumber\"\n                    label=\"Card #\"\n                    value={formData.cardNumber}\n                    onChange={(e) => onFieldChange('cardNumber', e.target.value)}\n                    error={!!validationErrors.cardNumber}\n                    helperText={validationErrors.cardNumber || '16 digits'}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 16 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <CreditCard color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Divider sx={{ my: 3 }} />\n\n              {/* Secci贸n de Detalles de Transacci贸n */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Transaction Details\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionTypeCode\"\n                    label=\"Type CD\"\n                    value={formData.transactionTypeCode}\n                    onChange={(e) => onFieldChange('transactionTypeCode', e.target.value)}\n                    error={!!validationErrors.transactionTypeCode}\n                    helperText={validationErrors.transactionTypeCode}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 2 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Category color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionCategoryCode\"\n                    label=\"Category CD\"\n                    value={formData.transactionCategoryCode}\n                    onChange={(e) => onFieldChange('transactionCategoryCode', e.target.value)}\n                    error={!!validationErrors.transactionCategoryCode}\n                    helperText={validationErrors.transactionCategoryCode}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 4 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Category color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionSource\"\n                    label=\"Source\"\n                    value={formData.transactionSource}\n                    onChange={(e) => onFieldChange('transactionSource', e.target.value)}\n                    error={!!validationErrors.transactionSource}\n                    helperText={validationErrors.transactionSource}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 10 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Source color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12}>\n                  <TextField\n                    name=\"transactionDescription\"\n                    label=\"Description\"\n                    value={formData.transactionDescription}\n                    onChange={(e) => onFieldChange('transactionDescription', e.target.value)}\n                    error={!!validationErrors.transactionDescription}\n                    helperText={validationErrors.transactionDescription}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 60 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Description color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionAmount\"\n                    label=\"Amount\"\n                    value={formData.transactionAmount}\n                    onChange={(e) => onFieldChange('transactionAmount', e.target.value)}\n                    error={!!validationErrors.transactionAmount}\n                    helperText={validationErrors.transactionAmount || '(-99999999.99)'}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 12 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <AttachMoney color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"originalDate\"\n                    label=\"Orig Date\"\n                    type=\"date\"\n                    value={formData.originalDate}\n                    onChange={(e) => onFieldChange('originalDate', e.target.value)}\n                    error={!!validationErrors.originalDate}\n                    helperText={validationErrors.originalDate || '(YYYY-MM-DD)'}\n                    disabled={loading}\n                    fullWidth\n                    InputLabelProps={{ shrink: true }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <DateRange color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"processDate\"\n                    label=\"Proc Date\"\n                    type=\"date\"\n                    value={formData.processDate}\n                    onChange={(e) => onFieldChange('processDate', e.target.value)}\n                    error={!!validationErrors.processDate}\n                    helperText={validationErrors.processDate || '(YYYY-MM-DD)'}\n                    disabled={loading}\n                    fullWidth\n                    InputLabelProps={{ shrink: true }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <DateRange color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Divider sx={{ my: 3 }} />\n\n              {/* Secci贸n de Comerciante */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Merchant Information\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantId\"\n                    label=\"Merchant ID\"\n                    value={formData.merchantId}\n                    onChange={(e) => onFieldChange('merchantId', e.target.value)}\n                    error={!!validationErrors.merchantId}\n                    helperText={validationErrors.merchantId}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 9 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Store color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantName\"\n                    label=\"Merchant Name\"\n                    value={formData.merchantName}\n                    onChange={(e) => onFieldChange('merchantName', e.target.value)}\n                    error={!!validationErrors.merchantName}\n                    helperText={validationErrors.merchantName}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 30 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Store color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantCity\"\n                    label=\"Merchant City\"\n                    value={formData.merchantCity}\n                    onChange={(e) => onFieldChange('merchantCity', e.target.value)}\n                    error={!!validationErrors.merchantCity}\n                    helperText={validationErrors.merchantCity}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 25 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <LocationCity color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantZip\"\n                    label=\"Merchant Zip\"\n                    value={formData.merchantZip}\n                    onChange={(e) => onFieldChange('merchantZip', e.target.value)}\n                    error={!!validationErrors.merchantZip}\n                    helperText={validationErrors.merchantZip}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 10 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <PostAdd color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Divider sx={{ my: 3 }} />\n\n              {/* Secci贸n de Confirmaci贸n */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Confirmation\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={6}>\n                  <Typography variant=\"body1\" color=\"text.primary\" sx={{ mb: 2 }}>\n                    You are about to add this transaction. Please confirm:\n                  </Typography>\n                  <FormControl fullWidth error={!!validationErrors.confirmation}>\n                    <InputLabel>Confirm</InputLabel>\n                    <Select\n                      value={formData.confirmation}\n                      onChange={(e) => onFieldChange('confirmation', e.target.value)}\n                      disabled={loading}\n                      startAdornment={\n                        <InputAdornment position=\"start\">\n                          <CheckCircle color=\"primary\" />\n                        </InputAdornment>\n                      }\n                      sx={{\n                        borderRadius: 2,\n                      }}\n                    >\n                      <MenuItem value=\"\">Select...</MenuItem>\n                      <MenuItem value=\"Y\">Yes (Y)</MenuItem>\n                      <MenuItem value=\"N\">No (N)</MenuItem>\n                    </Select>\n                    {validationErrors.confirmation && (\n                      <Typography variant=\"caption\" color=\"error\" sx={{ mt: 0.5, ml: 1.5 }}>\n                        {validationErrors.confirmation}\n                      </Typography>\n                    )}\n                  </FormControl>\n                </Grid>\n              </Grid>\n\n              {/* Mensajes */}\n              {error && (\n                <Alert severity=\"error\" sx={{ mb: 3, borderRadius: 2 }}>\n                  {error}\n                </Alert>\n              )}\n              \n              {successMessage && (\n                <Alert severity=\"success\" sx={{ mb: 3, borderRadius: 2 }}>\n                  {successMessage}\n                </Alert>\n              )}\n\n              {/* Botones de Acci贸n */}\n              <Stack\n                direction={{ xs: 'column', sm: 'row' }}\n                spacing={2}\n                justifyContent=\"center\"\n                sx={{ mt: 4 }}\n              >\n                <Button\n                  type=\"submit\"\n                  variant=\"contained\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<AddIcon />}\n                  sx={{\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                    fontWeight: 600,\n                  }}\n                >\n                  {loading ? 'Adding...' : 'ENTER = Continue'}\n                </Button>\n                \n                <Button\n                  variant=\"outlined\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<CopyIcon />}\n                  onClick={onCopyLastTransaction}\n                  sx={{\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                  }}\n                >\n                  F5 = Copy Last Tran.\n                </Button>\n                \n                <Button\n                  variant=\"outlined\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<ClearIcon />}\n                  onClick={onClearForm}\n                  sx={{\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                  }}\n                >\n                  F4 = Clear\n                </Button>\n                \n                <Button\n                  variant=\"outlined\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<ExitIcon />}\n                  onClick={onExit}\n                  sx={\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                  }}\n                >\n                  F3 = Back\n                </Button>\n              </Stack>\n            </Box>\n          </Box>\n        </Paper>\n      </Box>\n    </Container>\n  );\n}",
  
  "app/pages/TransactionAddPage.tsx": "// app/pages/TransactionAddPage.tsx\nimport React, { useEffect, useState } from 'react';\nimport { TransactionAddScreen } from '~/components/transaction/TransactionAddScreen';\nimport { useTransactionAdd } from '~/hooks/useTransactionAdd';\nimport type { TransactionAddResponse } from '~/types/transaction';\n\nexport default function TransactionAddPage() {\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  \n  const {\n    transactionState,\n    loading,\n    error,\n    handleAutoFill,\n    handleFieldChange,\n    handleSubmit,\n    handleCopyLastTransaction,\n    handleClearForm,\n    handleExit,\n  } = useTransactionAdd({\n    onSuccess: (data: TransactionAddResponse) => {\n      setSuccessMessage(data.message);\n      // Limpiar mensaje despu茅s de 5 segundos\n      setTimeout(() => setSuccessMessage(null), 5000);\n    },\n    onError: (error: string) => {\n      console.error('Error adding transaction:', error);\n      setSuccessMessage(null);\n    },\n  });\n\n  // Auto-llenar campos si viene de otra pantalla\n  useEffect(() => {\n    handleAutoFill();\n  }, [handleAutoFill]);\n\n  return (\n    <TransactionAddScreen\n      formData={transactionState.formData}\n      validationErrors={transactionState.validationErrors}\n      loading={loading}\n      error={error}\n      successMessage={successMessage}\n      onFieldChange={handleFieldChange}\n      onSubmit={handleSubmit}\n      onCopyLastTransaction={handleCopyLastTransaction}\n      onClearForm={handleClearForm}\n      onExit={handleExit}\n    />\n  );\n}",
  
  "app/mocks/transactionHandlers.ts": "// app/mocks/transactionHandlers.ts\nimport { http, HttpResponse } from 'msw';\nimport type { TransactionAddResponse } from '~/types/transaction';\n\n// Estado compartido para transacciones\nlet transactionCounter = 1000000000000; // Empezar con un ID alto como en el mainframe\n\n// Mock data para 煤ltimas transacciones por cuenta/tarjeta\nconst lastTransactionsByAccount: Record<string, any> = {\n  '11111111111': {\n    transactionTypeCode: '01',\n    transactionCategoryCode: '5411',\n    transactionSource: 'ONLINE',\n    transactionDescription: 'COMPRA EN SUPERMERCADO XYZ',\n    transactionAmount: '150.75',\n    originalDate: '2024-12-15',\n    processDate: '2024-12-15',\n    merchantId: '987654321',\n    merchantName: 'SUPERMERCADO XYZ',\n    merchantCity: 'CIUDAD EJEMPLO',\n    merchantZip: '28080',\n  },\n  '4111111111111111': {\n    transactionTypeCode: '02',\n    transactionCategoryCode: '5812',\n    transactionSource: 'POS',\n    transactionDescription: 'RESTAURANTE ABC',\n    transactionAmount: '45.50',\n    originalDate: '2024-12-14',\n    processDate: '2024-12-14',\n    merchantId: '123456789',\n    merchantName: 'RESTAURANTE ABC',\n    merchantCity: 'MADRID',\n    merchantZip: '28001',\n  },\n};\n\n// Datos de referencia cruzada (simulando CCXREF)\nconst cardAccountXref: Record<string, string> = {\n  '11111111111': '4111111111111111',\n  '22222222222': '4222222222222222',\n  '33333333333': '4333333333333333',\n  '4111111111111111': '11111111111',\n  '4222222222222222': '22222222222',\n  '4333333333333333': '33333333333',\n};\n\nexport const transactionHandlers = [\n  // POST /api/transactions - Agregar nueva transacci贸n\n  http.post('/api/transactions', async ({ request }) => {\n    const body = await request.json() as {\n      accountId?: string;\n      cardNumber?: string;\n      transactionTypeCode: string;\n      transactionCategoryCode: string;\n      transactionSource: string;\n      transactionDescription: string;\n      transactionAmount: number;\n      originalDate: string;\n      processDate: string;\n      merchantId: string;\n      merchantName: string;\n      merchantCity: string;\n      merchantZip: string;\n      confirmation: string;\n    };\n\n    console.log(' Transaction Add Request:', body);\n\n    // Simular delay de red\n    await new Promise(resolve => setTimeout(resolve, 1200));\n\n    // Validaciones como en el COBOL original\n    if (body.confirmation?.toUpperCase() !== 'Y') {\n      return HttpResponse.json({\n        success: false,\n        message: 'Confirm to add this transaction...',\n      } as TransactionAddResponse, { status: 400 });\n    }\n\n    // Validar que se proporcione Account ID o Card Number\n    if (!body.accountId && !body.cardNumber) {\n      return HttpResponse.json({\n        success: false,\n        message: 'Account or Card Number must be entered...',\n      } as TransactionAddResponse, { status: 400 });\n    }\n\n    // Validar Account ID si se proporciona\n    if (body.accountId) {\n      if (!/^\\d{11}$/.test(body.accountId) || body.accountId === '00000000000') {\n        return HttpResponse.json({\n          success: false,\n          message: 'Account ID must be Numeric...',\n        } as TransactionAddResponse, { status: 400 });\n      }\n\n      // Verificar que la cuenta exista en CCXREF\n      if (!cardAccountXref[body.accountId]) {\n        return HttpResponse.json({\n          success: false,\n          message: 'Account ID NOT found...',\n        } as TransactionAddResponse, { status: 400 });\n      }\n    }\n\n    // Validar Card Number si se proporciona\n    if (body.cardNumber) {\n      if (!/^\\d{16}$/.test(body.cardNumber)) {\n        return HttpResponse.json({\n          success: false,\n          message: 'Card Number must be Numeric...',\n        } as TransactionAddResponse
2025-10-13T16:54:57.810Z - Contenido original para debug:
Bas谩ndome en el c贸digo Mainframe COTRN02 (Transaction Add) y la estructura React existente, voy a crear la migraci贸n completa del componente de agregar transacciones.

```json
{
  "app/types/transaction.ts": "// app/types/transaction.ts\nexport interface TransactionAddRequest {\n  // Campos de identificaci贸n - uno de los dos debe estar presente\n  accountId?: string;\n  cardNumber?: string;\n  \n  // Datos de la transacci贸n\n  transactionTypeCode: string;\n  transactionCategoryCode: string;\n  transactionSource: string;\n  transactionDescription: string;\n  transactionAmount: string; // String para manejo de formato en frontend\n  originalDate: string; // YYYY-MM-DD format\n  processDate: string; // YYYY-MM-DD format\n  \n  // Datos del comerciante\n  merchantId: string;\n  merchantName: string;\n  merchantCity: string;\n  merchantZip: string;\n  \n  // Confirmaci贸n\n  confirmation: 'Y' | 'N' | '';\n}\n\nexport interface TransactionAddResponse {\n  transactionId?: string;\n  message: string;\n  success: boolean;\n}\n\nexport interface TransactionAddState {\n  formData: TransactionAddRequest;\n  validationErrors: Record<string, string>;\n  isSubmitting: boolean;\n  lastTransactionData?: TransactionAddRequest;\n}\n\nexport interface TransactionValidationResult {\n  isValid: boolean;\n  errors: Record<string, string>;\n}\n\n// Tipos para el 煤ltimo registro copiado\nexport interface LastTransactionData {\n  transactionTypeCode: string;\n  transactionCategoryCode: string;\n  transactionSource: string;\n  transactionDescription: string;\n  transactionAmount: string;\n  originalDate: string;\n  processDate: string;\n  merchantId: string;\n  merchantName: string;\n  merchantCity: string;\n  merchantZip: string;\n}",
  
  "app/hooks/useTransactionAdd.ts": "// app/hooks/useTransactionAdd.ts\nimport { useState, useCallback, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useMutation } from './useApi';\nimport { apiClient } from '~/services/api';\nimport type { \n  TransactionAddRequest, \n  TransactionAddResponse,\n  TransactionAddState,\n  TransactionValidationResult\n} from '~/types/transaction';\n\ninterface UseTransactionAddOptions {\n  onError?: (error: string) => void;\n  onSuccess?: (data: TransactionAddResponse) => void;\n}\n\ninterface LocationState {\n  cardNumber?: string;\n  accountId?: string;\n  fromList?: boolean;\n}\n\nexport function useTransactionAdd(options: UseTransactionAddOptions = {}) {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const state = location.state as LocationState;\n  \n  const hasAutoFilled = useRef(false);\n  \n  const [transactionState, setTransactionState] = useState<TransactionAddState>({\n    formData: {\n      accountId: state?.accountId || '',\n      cardNumber: state?.cardNumber || '',\n      transactionTypeCode: '',\n      transactionCategoryCode: '',\n      transactionSource: '',\n      transactionDescription: '',\n      transactionAmount: '',\n      originalDate: '',\n      processDate: '',\n      merchantId: '',\n      merchantName: '',\n      merchantCity: '',\n      merchantZip: '',\n      confirmation: '',\n    },\n    validationErrors: {},\n    isSubmitting: false,\n  });\n\n  // Mutation para agregar transacci贸n\n  const { mutate: addTransaction, loading: addLoading, error: addError } = useMutation(\n    async (request: TransactionAddRequest) => {\n      // Convertir datos para el backend\n      const backendRequest = {\n        accountId: request.accountId || undefined,\n        cardNumber: request.cardNumber || undefined,\n        transactionTypeCode: request.transactionTypeCode,\n        transactionCategoryCode: request.transactionCategoryCode,\n        transactionSource: request.transactionSource,\n        transactionDescription: request.transactionDescription,\n        transactionAmount: parseFloat(request.transactionAmount),\n        originalDate: new Date(request.originalDate + 'T00:00:00').toISOString(),\n        processDate: new Date(request.processDate + 'T00:00:00').toISOString(),\n        merchantId: request.merchantId,\n        merchantName: request.merchantName,\n        merchantCity: request.merchantCity,\n        merchantZip: request.merchantZip,\n        confirmation: request.confirmation,\n      };\n      \n      return apiClient.post<TransactionAddResponse>('/transactions', backendRequest);\n    },\n    {\n      onSuccess: (data: TransactionAddResponse) => {\n        if (data.success) {\n          // Limpiar formulario despu茅s del 茅xito\n          setTransactionState(prev => ({\n            ...prev,\n            formData: {\n              accountId: '',\n              cardNumber: '',\n              transactionTypeCode: '',\n              transactionCategoryCode: '',\n              transactionSource: '',\n              transactionDescription: '',\n              transactionAmount: '',\n              originalDate: '',\n              processDate: '',\n              merchantId: '',\n              merchantName: '',\n              merchantCity: '',\n              merchantZip: '',\n              confirmation: '',\n            },\n            validationErrors: {},\n          }));\n          options.onSuccess?.(data);\n        } else {\n          options.onError?.(data.message);\n        }\n      },\n      onError: (error: string) => {\n        options.onError?.(error);\n      },\n    }\n  );\n\n  // Mutation para obtener 煤ltima transacci贸n (F5 functionality)\n  const { mutate: getLastTransaction, loading: lastTranLoading } = useMutation(\n    async (request: { accountId?: string; cardNumber?: string }) => {\n      const params = new URLSearchParams();\n      if (request.accountId) params.append('accountId', request.accountId);\n      if (request.cardNumber) params.append('cardNumber', request.cardNumber);\n      \n      return apiClient.get<TransactionAddRequest>(`/transactions/last?${params.toString()}`);\n    },\n    {\n      onSuccess: (data: TransactionAddRequest) => {\n        setTransactionState(prev => ({\n          ...prev,\n          formData: {\n            ...prev.formData,\n            transactionTypeCode: data.transactionTypeCode,\n            transactionCategoryCode: data.transactionCategoryCode,\n            transactionSource: data.transactionSource,\n            transactionDescription: data.transactionDescription,\n            transactionAmount: data.transactionAmount,\n            originalDate: data.originalDate,\n            processDate: data.processDate,\n            merchantId: data.merchantId,\n            merchantName: data.merchantName,\n            merchantCity: data.merchantCity,\n            merchantZip: data.merchantZip,\n          },\n          lastTransactionData: data,\n        }));\n      },\n      onError: (error: string) => {\n        options.onError?.(error);\n      },\n    }\n  );\n\n  // Auto-llenar campos si viene de otra pantalla\n  const handleAutoFill = useCallback(() => {\n    if ((state?.accountId || state?.cardNumber) && !hasAutoFilled.current) {\n      hasAutoFilled.current = true;\n      setTransactionState(prev => ({\n        ...prev,\n        formData: {\n          ...prev.formData,\n          accountId: state.accountId || '',\n          cardNumber: state.cardNumber || '',\n        },\n      }));\n    }\n  }, [state]);\n\n  // Validaciones como en el COBOL original\n  const validateForm = useCallback((): TransactionValidationResult => {\n    const errors: Record<string, string> = {};\n    const { formData } = transactionState;\n\n    // Validar Account ID o Card Number (uno debe estar presente)\n    if (!formData.accountId && !formData.cardNumber) {\n      errors.accountId = 'Account or Card Number must be entered...';\n    }\n\n    if (formData.accountId) {\n      if (!/^\\d{11}$/.test(formData.accountId) || formData.accountId === '00000000000') {\n        errors.accountId = 'Account ID must be Numeric...';\n      }\n    }\n\n    if (formData.cardNumber) {\n      if (!/^\\d{16}$/.test(formData.cardNumber)) {\n        errors.cardNumber = 'Card Number must be Numeric...';\n      }\n    }\n\n    // Validar campos obligatorios\n    if (!formData.transactionTypeCode) {\n      errors.transactionTypeCode = 'Type CD can NOT be empty...';\n    } else if (!/^\\d{1,2}$/.test(formData.transactionTypeCode)) {\n      errors.transactionTypeCode = 'Type CD must be Numeric...';\n    }\n\n    if (!formData.transactionCategoryCode) {\n      errors.transactionCategoryCode = 'Category CD can NOT be empty...';\n    } else if (!/^\\d{1,4}$/.test(formData.transactionCategoryCode)) {\n      errors.transactionCategoryCode = 'Category CD must be Numeric...';\n    }\n\n    if (!formData.transactionSource) {\n      errors.transactionSource = 'Source can NOT be empty...';\n    }\n\n    if (!formData.transactionDescription) {\n      errors.transactionDescription = 'Description can NOT be empty...';\n    }\n\n    if (!formData.transactionAmount) {\n      errors.transactionAmount = 'Amount can NOT be empty...';\n    } else {\n      // Validar formato de monto (-99999999.99)\n      const amountRegex = /^[+-]?\\d{1,8}(\\.\\d{1,2})?$/;\n      if (!amountRegex.test(formData.transactionAmount)) {\n        errors.transactionAmount = 'Amount should be in format -99999999.99';\n      }\n    }\n\n    if (!formData.originalDate) {\n      errors.originalDate = 'Orig Date can NOT be empty...';\n    } else {\n      // Validar formato YYYY-MM-DD\n      const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n      if (!dateRegex.test(formData.originalDate)) {\n        errors.originalDate = 'Orig Date should be in format YYYY-MM-DD';\n      } else {\n        // Validar que sea una fecha v谩lida\n        const date = new Date(formData.originalDate);\n        if (isNaN(date.getTime())) {\n          errors.originalDate = 'Orig Date - Not a valid date...';\n        }\n      }\n    }\n\n    if (!formData.processDate) {\n      errors.processDate = 'Proc Date can NOT be empty...';\n    } else {\n      const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n      if (!dateRegex.test(formData.processDate)) {\n        errors.processDate = 'Proc Date should be in format YYYY-MM-DD';\n      } else {\n        const date = new Date(formData.processDate);\n        if (isNaN(date.getTime())) {\n          errors.processDate = 'Proc Date - Not a valid date...';\n        }\n      }\n    }\n\n    if (!formData.merchantId) {\n      errors.merchantId = 'Merchant ID can NOT be empty...';\n    } else if (!/^\\d+$/.test(formData.merchantId)) {\n      errors.merchantId = 'Merchant ID must be Numeric...';\n    }\n\n    if (!formData.merchantName) {\n      errors.merchantName = 'Merchant Name can NOT be empty...';\n    }\n\n    if (!formData.merchantCity) {\n      errors.merchantCity = 'Merchant City can NOT be empty...';\n    }\n\n    if (!formData.merchantZip) {\n      errors.merchantZip = 'Merchant Zip can NOT be empty...';\n    }\n\n    // Validar confirmaci贸n\n    if (!formData.confirmation) {\n      errors.confirmation = 'Confirm to add this transaction...';\n    } else if (!['Y', 'N'].includes(formData.confirmation.toUpperCase())) {\n      errors.confirmation = 'Invalid value. Valid values are (Y/N)...';\n    }\n\n    setTransactionState(prev => ({ ...prev, validationErrors: errors }));\n    return { isValid: Object.keys(errors).length === 0, errors };\n  }, [transactionState]);\n\n  // Manejar cambios en los campos\n  const handleFieldChange = useCallback((field: keyof TransactionAddRequest, value: string) => {\n    setTransactionState(prev => ({\n      ...prev,\n      formData: { ...prev.formData, [field]: value },\n      validationErrors: { ...prev.validationErrors, [field]: '' }, // Limpiar error del campo\n    }));\n  }, []);\n\n  // Manejar env铆o del formulario\n  const handleSubmit = useCallback(async () => {\n    const validation = validateForm();\n    \n    if (!validation.isValid) {\n      return;\n    }\n\n    if (transactionState.formData.confirmation.toUpperCase() !== 'Y') {\n      setTransactionState(prev => ({\n        ...prev,\n        validationErrors: { confirmation: 'Confirm to add this transaction...' },\n      }));\n      return;\n    }\n\n    await addTransaction(transactionState.formData);\n  }, [transactionState.formData, validateForm, addTransaction]);\n\n  // Copiar 煤ltima transacci贸n (F5)\n  const handleCopyLastTransaction = useCallback(async () => {\n    const { accountId, cardNumber } = transactionState.formData;\n    \n    if (!accountId && !cardNumber) {\n      setTransactionState(prev => ({\n        ...prev,\n        validationErrors: { accountId: 'Account or Card Number must be entered...' },\n      }));\n      return;\n    }\n\n    await getLastTransaction({ accountId, cardNumber });\n  }, [transactionState.formData, getLastTransaction]);\n\n  // Limpiar formulario (F4)\n  const handleClearForm = useCallback(() => {\n    setTransactionState({\n      formData: {\n        accountId: '',\n        cardNumber: '',\n        transactionTypeCode: '',\n        transactionCategoryCode: '',\n        transactionSource: '',\n        transactionDescription: '',\n        transactionAmount: '',\n        originalDate: '',\n        processDate: '',\n        merchantId: '',\n        merchantName: '',\n        merchantCity: '',\n        merchantZip: '',\n        confirmation: '',\n      },\n      validationErrors: {},\n      isSubmitting: false,\n    });\n  }, []);\n\n  // Salir (F3)\n  const handleExit = useCallback(() => {\n    navigate('/menu/main');\n  }, [navigate]);\n\n  return {\n    // Estado\n    transactionState,\n    loading: addLoading || lastTranLoading,\n    error: addError,\n    \n    // Acciones\n    handleAutoFill,\n    handleFieldChange,\n    handleSubmit,\n    handleCopyLastTransaction,\n    handleClearForm,\n    handleExit,\n    \n    // Utilidades\n    validateForm,\n    isFromList: !!state?.fromList,\n  };\n}",
  
  "app/components/transaction/TransactionAddScreen.tsx": "// app/components/transaction/TransactionAddScreen.tsx\nimport React, { useEffect } from 'react';\nimport {\n  Container,\n  Box,\n  Paper,\n  Typography,\n  TextField,\n  Button,\n  Grid,\n  Alert,\n  Divider,\n  Stack,\n  useTheme,\n  alpha,\n  InputAdornment,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n} from '@mui/material';\nimport {\n  Add as AddIcon,\n  Clear as ClearIcon,\n  FileCopy as CopyIcon,\n  ExitToApp as ExitIcon,\n  AccountBalance,\n  CreditCard,\n  Category,\n  Source,\n  Description,\n  AttachMoney,\n  DateRange,\n  Store,\n  LocationCity,\n  PostAdd,\n  CheckCircle,\n} from '@mui/icons-material';\nimport { SystemHeader } from '~/components/layout/SystemHeader';\nimport type { TransactionAddRequest } from '~/types/transaction';\n\ninterface TransactionAddScreenProps {\n  formData: TransactionAddRequest;\n  validationErrors: Record<string, string>;\n  loading: boolean;\n  error?: string | null;\n  successMessage?: string | null;\n  onFieldChange: (field: keyof TransactionAddRequest, value: string) => void;\n  onSubmit: () => void;\n  onCopyLastTransaction: () => void;\n  onClearForm: () => void;\n  onExit: () => void;\n}\n\nexport function TransactionAddScreen({\n  formData,\n  validationErrors,\n  loading,\n  error,\n  successMessage,\n  onFieldChange,\n  onSubmit,\n  onCopyLastTransaction,\n  onClearForm,\n  onExit,\n}: TransactionAddScreenProps) {\n  const theme = useTheme();\n\n  // Auto-focus en el primer campo\n  useEffect(() => {\n    const firstInput = document.querySelector('input[name=\"accountId\"]') as HTMLInputElement;\n    if (firstInput && !formData.accountId && !formData.cardNumber) {\n      firstInput.focus();\n    }\n  }, [formData.accountId, formData.cardNumber]);\n\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (event.key === 'F3' || event.key === 'Escape') {\n      event.preventDefault();\n      onExit();\n    } else if (event.key === 'F4') {\n      event.preventDefault();\n      onClearForm();\n    } else if (event.key === 'F5') {\n      event.preventDefault();\n      onCopyLastTransaction();\n    }\n  };\n\n  const handleSubmit = (event: React.FormEvent) => {\n    event.preventDefault();\n    onSubmit();\n  };\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ py: 3 }}>\n      <Box onKeyDown={handleKeyDown} tabIndex={-1}>\n        <SystemHeader\n          transactionId=\"CT02\"\n          programName=\"COTRN02C\"\n          title=\"Add Transaction\"\n        />\n\n        <Paper\n          elevation={2}\n          sx={{\n            borderRadius: 3,\n            overflow: 'hidden',\n            background: `linear-gradient(145deg, ${alpha(theme.palette.background.paper, 0.9)}, ${alpha(theme.palette.background.default, 0.1)})`,\n          }}\n        >\n          {/* Header */}\n          <Box\n            sx={{\n              p: 3,\n              textAlign: 'center',\n              background: `linear-gradient(135deg, ${theme.palette.primary.main}, ${theme.palette.secondary.main})`,\n              color: 'white',\n            }}\n          >\n            <AddIcon sx={{ fontSize: 48, mb: 1 }} />\n            <Typography variant=\"h4\" fontWeight={600}>\n              Add Transaction\n            </Typography>\n          </Box>\n\n          {/* Formulario */}\n          <Box sx={{ p: 4 }}>\n            <Box component=\"form\" onSubmit={handleSubmit}>\n              {/* Secci贸n de Identificaci贸n */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Account/Card Identification\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={5}>\n                  <TextField\n                    name=\"accountId\"\n                    label=\"Enter Acct #\"\n                    value={formData.accountId}\n                    onChange={(e) => onFieldChange('accountId', e.target.value)}\n                    error={!!validationErrors.accountId}\n                    helperText={validationErrors.accountId || '11 digits'}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 11 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <AccountBalance color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={2} sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n                  <Typography variant=\"body1\" color=\"text.secondary\">\n                    (or)\n                  </Typography>\n                </Grid>\n                \n                <Grid item xs={12} md={5}>\n                  <TextField\n                    name=\"cardNumber\"\n                    label=\"Card #\"\n                    value={formData.cardNumber}\n                    onChange={(e) => onFieldChange('cardNumber', e.target.value)}\n                    error={!!validationErrors.cardNumber}\n                    helperText={validationErrors.cardNumber || '16 digits'}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 16 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <CreditCard color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Divider sx={{ my: 3 }} />\n\n              {/* Secci贸n de Detalles de Transacci贸n */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Transaction Details\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionTypeCode\"\n                    label=\"Type CD\"\n                    value={formData.transactionTypeCode}\n                    onChange={(e) => onFieldChange('transactionTypeCode', e.target.value)}\n                    error={!!validationErrors.transactionTypeCode}\n                    helperText={validationErrors.transactionTypeCode}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 2 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Category color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionCategoryCode\"\n                    label=\"Category CD\"\n                    value={formData.transactionCategoryCode}\n                    onChange={(e) => onFieldChange('transactionCategoryCode', e.target.value)}\n                    error={!!validationErrors.transactionCategoryCode}\n                    helperText={validationErrors.transactionCategoryCode}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 4 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Category color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionSource\"\n                    label=\"Source\"\n                    value={formData.transactionSource}\n                    onChange={(e) => onFieldChange('transactionSource', e.target.value)}\n                    error={!!validationErrors.transactionSource}\n                    helperText={validationErrors.transactionSource}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 10 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Source color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12}>\n                  <TextField\n                    name=\"transactionDescription\"\n                    label=\"Description\"\n                    value={formData.transactionDescription}\n                    onChange={(e) => onFieldChange('transactionDescription', e.target.value)}\n                    error={!!validationErrors.transactionDescription}\n                    helperText={validationErrors.transactionDescription}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 60 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Description color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"transactionAmount\"\n                    label=\"Amount\"\n                    value={formData.transactionAmount}\n                    onChange={(e) => onFieldChange('transactionAmount', e.target.value)}\n                    error={!!validationErrors.transactionAmount}\n                    helperText={validationErrors.transactionAmount || '(-99999999.99)'}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 12 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <AttachMoney color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"originalDate\"\n                    label=\"Orig Date\"\n                    type=\"date\"\n                    value={formData.originalDate}\n                    onChange={(e) => onFieldChange('originalDate', e.target.value)}\n                    error={!!validationErrors.originalDate}\n                    helperText={validationErrors.originalDate || '(YYYY-MM-DD)'}\n                    disabled={loading}\n                    fullWidth\n                    InputLabelProps={{ shrink: true }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <DateRange color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={4}>\n                  <TextField\n                    name=\"processDate\"\n                    label=\"Proc Date\"\n                    type=\"date\"\n                    value={formData.processDate}\n                    onChange={(e) => onFieldChange('processDate', e.target.value)}\n                    error={!!validationErrors.processDate}\n                    helperText={validationErrors.processDate || '(YYYY-MM-DD)'}\n                    disabled={loading}\n                    fullWidth\n                    InputLabelProps={{ shrink: true }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <DateRange color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Divider sx={{ my: 3 }} />\n\n              {/* Secci贸n de Comerciante */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Merchant Information\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantId\"\n                    label=\"Merchant ID\"\n                    value={formData.merchantId}\n                    onChange={(e) => onFieldChange('merchantId', e.target.value)}\n                    error={!!validationErrors.merchantId}\n                    helperText={validationErrors.merchantId}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 9 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Store color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantName\"\n                    label=\"Merchant Name\"\n                    value={formData.merchantName}\n                    onChange={(e) => onFieldChange('merchantName', e.target.value)}\n                    error={!!validationErrors.merchantName}\n                    helperText={validationErrors.merchantName}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 30 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <Store color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantCity\"\n                    label=\"Merchant City\"\n                    value={formData.merchantCity}\n                    onChange={(e) => onFieldChange('merchantCity', e.target.value)}\n                    error={!!validationErrors.merchantCity}\n                    helperText={validationErrors.merchantCity}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 25 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <LocationCity color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n                \n                <Grid item xs={12} md={6}>\n                  <TextField\n                    name=\"merchantZip\"\n                    label=\"Merchant Zip\"\n                    value={formData.merchantZip}\n                    onChange={(e) => onFieldChange('merchantZip', e.target.value)}\n                    error={!!validationErrors.merchantZip}\n                    helperText={validationErrors.merchantZip}\n                    disabled={loading}\n                    fullWidth\n                    inputProps={{ maxLength: 10 }}\n                    InputProps={{\n                      startAdornment: (\n                        <InputAdornment position=\"start\">\n                          <PostAdd color=\"primary\" />\n                        </InputAdornment>\n                      ),\n                    }}\n                    sx={{\n                      '& .MuiOutlinedInput-root': {\n                        borderRadius: 2,\n                      },\n                    }}\n                  />\n                </Grid>\n              </Grid>\n\n              <Divider sx={{ my: 3 }} />\n\n              {/* Secci贸n de Confirmaci贸n */}\n              <Typography variant=\"h6\" color=\"primary.main\" gutterBottom sx={{ mb: 3 }}>\n                Confirmation\n              </Typography>\n              \n              <Grid container spacing={3} sx={{ mb: 4 }}>\n                <Grid item xs={12} md={6}>\n                  <Typography variant=\"body1\" color=\"text.primary\" sx={{ mb: 2 }}>\n                    You are about to add this transaction. Please confirm:\n                  </Typography>\n                  <FormControl fullWidth error={!!validationErrors.confirmation}>\n                    <InputLabel>Confirm</InputLabel>\n                    <Select\n                      value={formData.confirmation}\n                      onChange={(e) => onFieldChange('confirmation', e.target.value)}\n                      disabled={loading}\n                      startAdornment={\n                        <InputAdornment position=\"start\">\n                          <CheckCircle color=\"primary\" />\n                        </InputAdornment>\n                      }\n                      sx={{\n                        borderRadius: 2,\n                      }}\n                    >\n                      <MenuItem value=\"\">Select...</MenuItem>\n                      <MenuItem value=\"Y\">Yes (Y)</MenuItem>\n                      <MenuItem value=\"N\">No (N)</MenuItem>\n                    </Select>\n                    {validationErrors.confirmation && (\n                      <Typography variant=\"caption\" color=\"error\" sx={{ mt: 0.5, ml: 1.5 }}>\n                        {validationErrors.confirmation}\n                      </Typography>\n                    )}\n                  </FormControl>\n                </Grid>\n              </Grid>\n\n              {/* Mensajes */}\n              {error && (\n                <Alert severity=\"error\" sx={{ mb: 3, borderRadius: 2 }}>\n                  {error}\n                </Alert>\n              )}\n              \n              {successMessage && (\n                <Alert severity=\"success\" sx={{ mb: 3, borderRadius: 2 }}>\n                  {successMessage}\n                </Alert>\n              )}\n\n              {/* Botones de Acci贸n */}\n              <Stack\n                direction={{ xs: 'column', sm: 'row' }}\n                spacing={2}\n                justifyContent=\"center\"\n                sx={{ mt: 4 }}\n              >\n                <Button\n                  type=\"submit\"\n                  variant=\"contained\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<AddIcon />}\n                  sx={{\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                    fontWeight: 600,\n                  }}\n                >\n                  {loading ? 'Adding...' : 'ENTER = Continue'}\n                </Button>\n                \n                <Button\n                  variant=\"outlined\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<CopyIcon />}\n                  onClick={onCopyLastTransaction}\n                  sx={{\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                  }}\n                >\n                  F5 = Copy Last Tran.\n                </Button>\n                \n                <Button\n                  variant=\"outlined\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<ClearIcon />}\n                  onClick={onClearForm}\n                  sx={{\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                  }}\n                >\n                  F4 = Clear\n                </Button>\n                \n                <Button\n                  variant=\"outlined\"\n                  size=\"large\"\n                  disabled={loading}\n                  startIcon={<ExitIcon />}\n                  onClick={onExit}\n                  sx={\n                    borderRadius: 2,\n                    px: 4,\n                    py: 1.5,\n                  }}\n                >\n                  F3 = Back\n                </Button>\n              </Stack>\n            </Box>\n          </Box>\n        </Paper>\n      </Box>\n    </Container>\n  );\n}",
  
  "app/pages/TransactionAddPage.tsx": "// app/pages/TransactionAddPage.tsx\nimport React, { useEffect, useState } from 'react';\nimport { TransactionAddScreen } from '~/components/transaction/TransactionAddScreen';\nimport { useTransactionAdd } from '~/hooks/useTransactionAdd';\nimport type { TransactionAddResponse } from '~/types/transaction';\n\nexport default function TransactionAddPage() {\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  \n  const {\n    transactionState,\n    loading,\n    error,\n    handleAutoFill,\n    handleFieldChange,\n    handleSubmit,\n    handleCopyLastTransaction,\n    handleClearForm,\n    handleExit,\n  } = useTransactionAdd({\n    onSuccess: (data: TransactionAddResponse) => {\n      setSuccessMessage(data.message);\n      // Limpiar mensaje despu茅s de 5 segundos\n      setTimeout(() => setSuccessMessage(null), 5000);\n    },\n    onError: (error: string) => {\n      console.error('Error adding transaction:', error);\n      setSuccessMessage(null);\n    },\n  });\n\n  // Auto-llenar campos si viene de otra pantalla\n  useEffect(() => {\n    handleAutoFill();\n  }, [handleAutoFill]);\n\n  return (\n    <TransactionAddScreen\n      formData={transactionState.formData}\n      validationErrors={transactionState.validationErrors}\n      loading={loading}\n      error={error}\n      successMessage={successMessage}\n      onFieldChange={handleFieldChange}\n      onSubmit={handleSubmit}\n      onCopyLastTransaction={handleCopyLastTransaction}\n      onClearForm={handleClearForm}\n      onExit={handleExit}\n    />\n  );\n}",
  
  "app/mocks/transactionHandlers.ts": "// app/mocks/transactionHandlers.ts\nimport { http, HttpResponse } from 'msw';\nimport type { TransactionAddResponse } from '~/types/transaction';\n\n// Estado compartido para transacciones\nlet transactionCounter = 1000000000000; // Empezar con un ID alto como en el mainframe\n\n// Mock data para 煤ltimas transacciones por cuenta/tarjeta\nconst lastTransactionsByAccount: Record<string, any> = {\n  '11111111111': {\n    transactionTypeCode: '01',\n    transactionCategoryCode: '5411',\n    transactionSource: 'ONLINE',\n    transactionDescription: 'COMPRA EN SUPERMERCADO XYZ',\n    transactionAmount: '150.75',\n    originalDate: '2024-12-15',\n    processDate: '2024-12-15',\n    merchantId: '987654321',\n    merchantName: 'SUPERMERCADO XYZ',\n    merchantCity: 'CIUDAD EJEMPLO',\n    merchantZip: '28080',\n  },\n  '4111111111111111': {\n    transactionTypeCode: '02',\n    transactionCategoryCode: '5812',\n    transactionSource: 'POS',\n    transactionDescription: 'RESTAURANTE ABC',\n    transactionAmount: '45.50',\n    originalDate: '2024-12-14',\n    processDate: '2024-12-14',\n    merchantId: '123456789',\n    merchantName: 'RESTAURANTE ABC',\n    merchantCity: 'MADRID',\n    merchantZip: '28001',\n  },\n};\n\n// Datos de referencia cruzada (simulando CCXREF)\nconst cardAccountXref: Record<string, string> = {\n  '11111111111': '4111111111111111',\n  '22222222222': '4222222222222222',\n  '33333333333': '4333333333333333',\n  '4111111111111111': '11111111111',\n  '4222222222222222': '22222222222',\n  '4333333333333333': '33333333333',\n};\n\nexport const transactionHandlers = [\n  // POST /api/transactions - Agregar nueva transacci贸n\n  http.post('/api/transactions', async ({ request }) => {\n    const body = await request.json() as {\n      accountId?: string;\n      cardNumber?: string;\n      transactionTypeCode: string;\n      transactionCategoryCode: string;\n      transactionSource: string;\n      transactionDescription: string;\n      transactionAmount: number;\n      originalDate: string;\n      processDate: string;\n      merchantId: string;\n      merchantName: string;\n      merchantCity: string;\n      merchantZip: string;\n      confirmation: string;\n    };\n\n    console.log(' Transaction Add Request:', body);\n\n    // Simular delay de red\n    await new Promise(resolve => setTimeout(resolve, 1200));\n\n    // Validaciones como en el COBOL original\n    if (body.confirmation?.toUpperCase() !== 'Y') {\n      return HttpResponse.json({\n        success: false,\n        message: 'Confirm to add this transaction...',\n      } as TransactionAddResponse, { status: 400 });\n    }\n\n    // Validar que se proporcione Account ID o Card Number\n    if (!body.accountId && !body.cardNumber) {\n      return HttpResponse.json({\n        success: false,\n        message: 'Account or Card Number must be entered...',\n      } as TransactionAddResponse, { status: 400 });\n    }\n\n    // Validar Account ID si se proporciona\n    if (body.accountId) {\n      if (!/^\\d{11}$/.test(body.accountId) || body.accountId === '00000000000') {\n        return HttpResponse.json({\n          success: false,\n          message: 'Account ID must be Numeric...',\n        } as TransactionAddResponse, { status: 400 });\n      }\n\n      // Verificar que la cuenta exista en CCXREF\n      if (!cardAccountXref[body.accountId]) {\n        return HttpResponse.json({\n          success: false,\n          message: 'Account ID NOT found...',\n        } as TransactionAddResponse, { status: 400 });\n      }\n    }\n\n    // Validar Card Number si se proporciona\n    if (body.cardNumber) {\n      if (!/^\\d{16}$/.test(body.cardNumber)) {\n        return HttpResponse.json({\n          success: false,\n          message: 'Card Number must be Numeric...',\n        } as TransactionAddResponse
2025-10-13T16:54:57.810Z - Error al parsear estructura: No se pudo extraer ninguna estructura de archivos del markdown
2025-10-13T16:54:57.811Z - Respuesta enviada como an谩lisis - no contiene estructura de archivos
2025-10-13T16:54:57.810Z - Info: No se encontraron archivos en la estructura parseada - posible contenido de an谩lisis
