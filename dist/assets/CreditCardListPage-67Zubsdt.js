import{u as Q,j as e,a as Z,B as j,P as V,g as f,b as i,h as M,v as $,N as x,i as G,k as K,S as W,d as C,G as ee,ae as te,J as re,A as ae,af as se,ag as ne,ah as ce,ai as z,aj as b,ak as ie,I as H,m as oe,a3 as le,al as de,am as ue,y as xe}from"./mui-bVcw8cZ8.js";import{r as n}from"./vendor-BPyidg2q.js";import{S as he}from"./SystemHeader-DB4NlgIL.js";import{g as me,L as pe}from"./index-85Pf7yId.js";import{u as be}from"./useApi-EeZ7am_M.js";import{u as Y}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";function ge(l={}){const a=Y(),[g,S]=n.useState(1),[k,B]=n.useState({}),[A,h]=n.useState({}),[u,O]=n.useState({}),m={};l.onSuccess&&(m.onSuccess=r=>l.onSuccess(r)),l.onError&&(m.onError=r=>l.onError(r));const{mutate:o,loading:y,error:v,data:d}=be(r=>me.post("/credit-cards/list",r),m),R=n.useCallback(r=>{const c={};return r.cardNumber&&(/^\d{16}$/.test(r.cardNumber)||(c.cardNumber="CARD ID FILTER, IF SUPPLIED MUST BE A 16 DIGIT NUMBER")),O(c),Object.keys(c).length===0},[]),T=n.useCallback(async r=>{if(!R(r))return;const c={...r,pageNumber:1,pageSize:7};B(c),S(1),h({}),await o(c)},[o,R]),w=n.useCallback(async r=>{const c={...k,pageNumber:r,pageSize:7};S(r),await o(c)},[k,o]),D=n.useCallback((r,c)=>{h(F=>{const p={...F};return c===""?delete p[r]:(Object.keys(p).forEach(E=>{delete p[parseInt(E)]}),p[r]=c),p})},[]),P=n.useCallback(()=>{const r=Object.entries(A);if(r.length===0)return;if(r.length>1){l.onError?.("PLEASE SELECT ONLY ONE RECORD TO VIEW OR UPDATE");return}const c=r[0];if(!c)return;const[F,p]=c,E=parseInt(F),I=d?.content[E];I&&(p==="S"?a("/cards/view",{state:{accountNumber:I.accountNumber,cardNumber:I.cardNumber}}):p==="U"&&a("/cards/update",{state:{accountNumber:I.accountNumber,cardNumber:I.cardNumber}}))},[A,d,a,l]),L=n.useCallback(()=>{a("/menu/main")},[a]);return{data:d,loading:y,error:v||(Object.keys(u).length>0?"Please correct the validation errors":null),currentPage:g,filters:k,selectedCards:A,validationErrors:u,handleSearch:T,handlePageChange:w,handleCardSelection:D,handleProcessSelection:P,handleExit:L,canGoNext:d?!d.last:!1,canGoPrev:d?!d.first:!1,totalPages:d?.totalPages||0,totalElements:d?.totalElements||0}}function je({onExit:l}){const a=Q(),[g,S]=n.useState({accountId:"",cardNumber:""}),[k,B]=n.useState(!1),A=[{accountId:"12345678901",cardNumber:"4532123456789012",description:"Active Account - Multiple Cards",expectedResults:2,status:"Active"},{accountId:"98765432109",cardNumber:"5555666677778888",description:"Mixed Status Account",expectedResults:2,status:"Mixed"},{accountId:"11111111111",cardNumber:"4111111111111111",description:"Single Expired Card",expectedResults:1,status:"Expired"},{accountId:"22222222222",cardNumber:"4222222222222222",description:"Active Premium Account",expectedResults:1,status:"Active"},{accountId:"33333333333",cardNumber:"4333333333333333",description:"High Volume Account",expectedResults:1,status:"Active"},{accountId:"44444444444",cardNumber:"4444444444444444",description:"Inactive Account",expectedResults:1,status:"Inactive"}],{data:h,loading:u,error:O,currentPage:m,selectedCards:o,validationErrors:y,handleSearch:v,handlePageChange:d,handleCardSelection:R,handleProcessSelection:T,handleExit:w,canGoNext:D,canGoPrev:P,totalPages:L,totalElements:r}=ge({onError:t=>console.error("Credit card list error:",t),onSuccess:t=>console.log("Credit cards loaded:",t.numberOfElements)}),c=n.useCallback(t=>s=>{const N=s.target.value;let U=N;t==="cardNumber"&&N.length>16&&(U=N.slice(0,16)),(t==="accountId"||t==="cardNumber")&&(U=U.replace(/\D/g,"")),S(q=>({...q,[t]:U}))},[]),F=n.useCallback(t=>{t.preventDefault(),v(g)},[g,v]),p=n.useCallback(()=>{S({accountId:"",cardNumber:""})},[]),E=n.useCallback((t,s)=>{const N={accountId:s==="account"?t.accountId:"",cardNumber:s==="card"?t.cardNumber:""};S(N),v(N),B(!1)},[v]),I=n.useCallback(t=>{t.key==="F3"||t.key==="Escape"?(t.preventDefault(),l?l():w()):t.key==="F7"?(t.preventDefault(),P&&d(m-1)):t.key==="F8"?(t.preventDefault(),D&&d(m+1)):t.key==="Enter"&&Object.keys(o).length>0&&(t.preventDefault(),T())},[l,w,P,D,m,d,o,T]),X=t=>{switch(t){case"ACTIVE":return"success";case"INACTIVE":return"default";case"BLOCKED":return"error";case"EXPIRED":return"warning";default:return"default"}},J=t=>{switch(t){case"ACTIVE":return"A";case"INACTIVE":return"I";case"BLOCKED":return"B";case"EXPIRED":return"E";default:return t.charAt(0)}},_=t=>{switch(t){case"Active":return"success";case"Inactive":return"default";case"Mixed":return"warning";case"Expired":return"error";default:return"default"}};return e.jsx(Z,{maxWidth:"xl",sx:{py:3},children:e.jsxs(j,{onKeyDown:I,tabIndex:-1,children:[e.jsx(he,{transactionId:"CCLI",programName:"COCRDLIC",title:"List Credit Cards"}),e.jsxs(V,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${f(a.palette.background.paper,.9)}, ${f(a.palette.background.default,.1)})`},children:[e.jsx(j,{sx:{p:3,background:`linear-gradient(135deg, ${a.palette.primary.main}, ${a.palette.secondary.main})`,color:"white"},children:e.jsxs(i,{variant:"h5",fontWeight:600,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{}),"List Credit Cards",L>0&&e.jsx($,{label:`Page ${m}`,size:"small",sx:{ml:"auto",bgcolor:"rgba(255,255,255,0.2)",color:"white"}})]})}),e.jsxs(j,{sx:{p:3,borderBottom:`1px solid ${a.palette.divider}`},children:[e.jsx(j,{component:"form",onSubmit:F,children:e.jsxs(x,{container:!0,spacing:3,alignItems:"flex-end",children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(G,{label:"Account Number",value:g.accountId||"",onChange:c("accountId"),error:!!y.accountId,helperText:y.accountId||"11 digits",disabled:u,fullWidth:!0,inputProps:{maxLength:11,pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(i,{variant:"body2",color:"text.secondary",children:"#"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(G,{label:"Credit Card Number",value:g.cardNumber||"",onChange:c("cardNumber"),error:!!y.cardNumber,helperText:y.cardNumber||"16 digits",disabled:u,fullWidth:!0,inputProps:{maxLength:16,pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(M,{fontSize:"small",color:"action"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(W,{direction:"row",spacing:1,children:[e.jsx(C,{type:"submit",variant:"contained",disabled:u,startIcon:u?e.jsx(pe,{size:20}):e.jsx(ee,{}),sx:{borderRadius:2,minWidth:120},children:u?"Searching...":"Search"}),e.jsx(C,{variant:"outlined",onClick:p,disabled:u,startIcon:e.jsx(te,{}),sx:{borderRadius:2},children:"Clear"})]})})]})}),!1,e.jsx(re,{in:k,children:e.jsxs(V,{variant:"outlined",sx:{p:2,mt:2,bgcolor:f(a.palette.info.main,.05),borderColor:a.palette.info.main},children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,color:"info.main",fontWeight:600,children:"Test Data (Development Only)"}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Click on Account ID or Card Number to search"}),e.jsx(x,{container:!0,spacing:1,children:A.map((t,s)=>e.jsx(x,{item:!0,xs:12,children:e.jsx(j,{sx:{p:2,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:e.jsxs(x,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(W,{spacing:1,children:[e.jsxs(C,{variant:"text",size:"small",onClick:()=>E(t,"account"),sx:{justifyContent:"flex-start",textTransform:"none",fontFamily:"monospace",fontWeight:600,color:"primary.main"},children:["Account: ",t.accountId]}),e.jsxs(C,{variant:"text",size:"small",onClick:()=>E(t,"card"),sx:{justifyContent:"flex-start",textTransform:"none",fontFamily:"monospace",fontWeight:600,color:"secondary.main"},children:["Card: ",t.cardNumber]})]})}),e.jsxs(x,{item:!0,xs:12,sm:6,children:[e.jsx(i,{variant:"body2",fontWeight:500,children:t.description}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Expected results: ",t.expectedResults," card(s)"]})]}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx($,{label:t.status,size:"small",color:_(t.status),variant:"outlined"})})]})})},s))}),e.jsx(j,{sx:{mt:2,p:2,bgcolor:f(a.palette.warning.main,.1),borderRadius:1},children:e.jsxs(i,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Testing Tips:"}),e.jsx("br",{}),"• Search by Account ID to see all cards for that account",e.jsx("br",{}),"• Search by Card Number to find a specific card",e.jsx("br",{}),"• Leave both fields empty to see all cards (admin users only)",e.jsx("br",{}),"• Use F7/F8 for pagination when results span multiple pages",e.jsx("br",{}),"• Click S (View) or U (Update) buttons to select a card, then press ENTER"]})})]})})]}),O&&e.jsx(j,{sx:{p:2},children:e.jsx(ae,{severity:"error",sx:{borderRadius:2},children:O})}),h&&h.content.length>0&&e.jsx(j,{sx:{px:3,py:1,bgcolor:f(a.palette.success.main,.1)},children:e.jsxs(i,{variant:"body2",color:"success.dark",fontWeight:500,children:["Found ",r," card(s) • Showing page ",m," of ",L]})}),e.jsx(se,{children:e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs(z,{sx:{bgcolor:f(a.palette.primary.main,.1)},children:[e.jsx(b,{width:"10%",children:e.jsx(i,{variant:"subtitle2",fontWeight:600,children:"Select"})}),e.jsx(b,{width:"35%",children:e.jsx(i,{variant:"subtitle2",fontWeight:600,children:"Account Number"})}),e.jsx(b,{width:"40%",children:e.jsx(i,{variant:"subtitle2",fontWeight:600,children:"Card Number"})}),e.jsx(b,{width:"15%",children:e.jsx(i,{variant:"subtitle2",fontWeight:600,children:"Active"})})]})}),e.jsxs(ie,{children:[h?.content.map((t,s)=>e.jsxs(z,{hover:!0,sx:{"&:hover":{bgcolor:f(a.palette.primary.main,.05)}},children:[e.jsx(b,{children:e.jsxs(W,{direction:"row",spacing:.5,children:[e.jsx(H,{size:"small",onClick:()=>R(s,o[s]==="S"?"":"S"),color:o[s]==="S"?"primary":"default",sx:{border:o[s]==="S"?2:1,borderColor:o[s]==="S"?"primary.main":"divider"},title:"View Details (S)",children:e.jsx(oe,{fontSize:"small"})}),e.jsx(H,{size:"small",onClick:()=>R(s,o[s]==="U"?"":"U"),color:o[s]==="U"?"secondary":"default",sx:{border:o[s]==="U"?2:1,borderColor:o[s]==="U"?"secondary.main":"divider"},title:"Update Card (U)",children:e.jsx(le,{fontSize:"small"})})]})}),e.jsx(b,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",children:t.accountNumber})}),e.jsx(b,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",children:t.cardNumber})}),e.jsx(b,{children:e.jsx($,{label:J(t.cardStatus),size:"small",color:X(t.cardStatus),sx:{minWidth:32,fontWeight:600}})})]},`${t.accountNumber}-${t.cardNumber}`)),h&&h.content.length<7&&Array.from({length:7-h.content.length}).map((t,s)=>e.jsx(z,{sx:{height:57},children:e.jsx(b,{colSpan:4,children:" "})},`empty-${s}`)),!u&&(!h||h.content.length===0)&&e.jsx(z,{children:e.jsx(b,{colSpan:4,sx:{textAlign:"center",py:4},children:e.jsx(i,{color:"text.secondary",children:g.accountId||g.cardNumber?"No records found for this search condition":"Enter search criteria and click Search to find credit cards"})})})]})]})}),e.jsx(j,{sx:{p:2,bgcolor:f(a.palette.grey[100],.5),borderTop:`1px solid ${a.palette.divider}`},children:e.jsxs(x,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(x,{item:!0,children:Object.keys(o).length===0?e.jsx(i,{variant:"body2",color:"text.secondary",children:"TYPE S FOR DETAIL, U TO UPDATE ANY RECORD"}):e.jsx(C,{variant:"contained",onClick:T,disabled:u,sx:{borderRadius:2},children:"ENTER = Continue"})}),e.jsx(x,{item:!0,children:e.jsxs(W,{direction:"row",spacing:1,alignItems:"center",children:[r>0&&e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r," records found"]}),e.jsx(C,{variant:"outlined",size:"small",startIcon:e.jsx(de,{}),onClick:()=>d(m-1),disabled:!P||u,sx:{borderRadius:2},children:"F7 = Backward"}),e.jsx(C,{variant:"outlined",size:"small",endIcon:e.jsx(ue,{}),onClick:()=>d(m+1),disabled:!D||u,sx:{borderRadius:2},children:"F8 = Forward"}),e.jsx(C,{variant:"outlined",size:"small",startIcon:e.jsx(xe,{}),onClick:l||w,disabled:u,sx:{borderRadius:2},children:"F3 = Exit"})]})})]})})]})]})})}function Ne(){const l=Y();n.useEffect(()=>{if(!localStorage.getItem("userRole")){l("/login");return}},[l]);const a=()=>{l("/menu/main")};return e.jsx(je,{onExit:a})}export{Ne as default};
