import{u as V,j as e,B as x,P as G,g as y,b as d,af as ne,ag as oe,ah as se,ai as R,aj as l,ak as ie,v as le,a9 as ce,aa as de,I as pe,aE as xe,ac as ue,ad as he,d as C,aF as me,aG as ge,a as fe,aH as je,U as F,W as U,aq as q,aI as ye,aJ as X,a5 as E,aK as be,aL as $,X as Ce,aM as De,N as M,i as J,ab as Te,an as ve,A as I,D as Se,S as Re,aN as Ee,ae as $e,y as we,aB as K}from"./mui-bVcw8cZ8.js";import{a as Ie,r as u}from"./vendor-BPyidg2q.js";import{f as Q,a as L,S as ke}from"./SystemHeader-DB4NlgIL.js";import{u as B}from"./useApi-EeZ7am_M.js";import{g as Y}from"./index-85Pf7yId.js";import{u as Ae}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";function We({reportData:o}){const n=V(),r=s=>s.replace(/^0+/,"")||"0",c=s=>s.replace(/(\d{4})(?=\d)/g,"$1 "),p=s=>s<0?n.palette.error.main:s>1e3?n.palette.success.main:n.palette.text.primary,m=(s,g)=>e.jsxs(Ie.Fragment,{children:[g>0&&e.jsx(R,{children:e.jsx(l,{colSpan:8,sx:{borderBottom:`2px solid ${n.palette.divider}`,padding:0,height:8}})}),s.transactions.map((i,f)=>e.jsxs(R,{sx:{"&:hover":{backgroundColor:y(n.palette.primary.main,.04)},backgroundColor:i.amount<0?y(n.palette.error.main,.02):"inherit"},children:[e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:r(i.transactionId)}),e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"0.875rem"},children:c(i.cardNumber)}),e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"0.875rem",textAlign:"center"},children:e.jsx(le,{label:i.typeCode,size:"small",variant:"outlined",color:i.typeCode==="03"?"error":"primary"})}),e.jsx(l,{sx:{fontSize:"0.875rem"},children:i.typeDescription}),e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"0.875rem",textAlign:"center"},children:i.categoryCode.toString().padStart(3,"0")}),e.jsx(l,{sx:{fontSize:"0.875rem"},children:i.categoryDescription}),e.jsx(l,{sx:{fontSize:"0.875rem"},children:i.source}),e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"0.875rem",textAlign:"right",fontWeight:600,color:p(i.amount)},children:L(i.amount)})]},`tx-${i.transactionId}`)),e.jsxs(R,{sx:{backgroundColor:y(n.palette.primary.main,.08)},children:[e.jsxs(l,{colSpan:6,sx:{fontWeight:600,borderTop:`1px solid ${n.palette.divider}`},children:["ACCOUNT TOTAL (",s.transactionCount," transactions)"]}),e.jsx(l,{sx:{borderTop:`1px solid ${n.palette.divider}`}}),e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"0.875rem",textAlign:"right",fontWeight:700,borderTop:`1px solid ${n.palette.divider}`,color:p(s.accountTotal)},children:L(s.accountTotal)})]})]},`account-${s.accountId}`);return e.jsxs(x,{children:[e.jsxs(G,{elevation:2,sx:{p:3,mb:3,backgroundColor:y(n.palette.primary.main,.02)},children:[e.jsx(d,{variant:"h5",gutterBottom:!0,sx:{fontFamily:"monospace",fontWeight:700},children:"DETAILED TRANSACTION REPORT"}),e.jsxs(x,{sx:{display:"flex",gap:4,flexWrap:"wrap",mt:2},children:[e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Type:"})," ",o.reportType]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Period:"})," ",Q(o.startDate)," - ",Q(o.endDate)]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Accounts:"})," ",o.accountCount]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Transactions:"})," ",o.totalTransactionCount]})]})]}),e.jsx(ne,{component:G,elevation:2,sx:{maxHeight:"70vh","& .MuiTableCell-head":{backgroundColor:n.palette.primary.main,color:n.palette.primary.contrastText,fontWeight:700,position:"sticky",top:0,zIndex:1}},children:e.jsxs(oe,{stickyHeader:!0,size:"small",children:[e.jsx(se,{children:e.jsxs(R,{children:[e.jsx(l,{sx:{minWidth:120},children:"TRANS ID"}),e.jsx(l,{sx:{minWidth:180},children:"CARD NUMBER"}),e.jsx(l,{sx:{minWidth:80,textAlign:"center"},children:"TYPE"}),e.jsx(l,{sx:{minWidth:150},children:"TYPE DESCRIPTION"}),e.jsx(l,{sx:{minWidth:80,textAlign:"center"},children:"CAT"}),e.jsx(l,{sx:{minWidth:200},children:"CATEGORY DESCRIPTION"}),e.jsx(l,{sx:{minWidth:120},children:"SOURCE"}),e.jsx(l,{sx:{minWidth:120,textAlign:"right"},children:"AMOUNT"})]})}),e.jsxs(ie,{children:[o.accountGroups.map((s,g)=>m(s,g)),e.jsxs(R,{sx:{backgroundColor:y(n.palette.success.main,.1)},children:[e.jsxs(l,{colSpan:7,sx:{fontWeight:700,fontSize:"1rem",borderTop:`2px solid ${n.palette.success.main}`,borderBottom:`2px solid ${n.palette.success.main}`},children:["GRAND TOTAL (",o.totalTransactionCount," transactions in ",o.accountCount," accounts)"]}),e.jsx(l,{sx:{fontFamily:"monospace",fontSize:"1rem",textAlign:"right",fontWeight:700,color:n.palette.success.main,borderTop:`2px solid ${n.palette.success.main}`,borderBottom:`2px solid ${n.palette.success.main}`},children:L(o.grandTotal)})]})]})]})})]})}function Ne(o={}){const n=Ae(),[r,c]=u.useState({reportType:null,startDate:"",endDate:"",confirmation:"",validationErrors:{},isConfirmationStep:!1,reportData:null,showReport:!1}),p=u.useCallback(t=>({onSuccess:t,...o.onError&&{onError:o.onError}}),[o.onError]),{mutate:m,loading:s}=B(async t=>await Y.post("/v1/reports/transactions/monthly",t),p(t=>{t.success&&t.reportData&&c(a=>({...a,reportData:t.reportData,showReport:!0,reportType:null,confirmation:"",validationErrors:{},isConfirmationStep:!1})),o.onSuccess?.(t)})),{mutate:g,loading:i}=B(async t=>await Y.post("/v1/reports/transactions/yearly",t),p(t=>{t.success&&t.reportData&&c(a=>({...a,reportData:t.reportData,showReport:!0,reportType:null,confirmation:"",validationErrors:{},isConfirmationStep:!1})),o.onSuccess?.(t)})),{mutate:f,loading:D}=B(async t=>await Y.post("/v1/reports/transactions/custom",t),p(t=>{t.success&&t.reportData&&c(a=>({...a,reportData:t.reportData,showReport:!0,startDate:"",endDate:"",reportType:null,confirmation:"",validationErrors:{},isConfirmationStep:!1})),o.onSuccess?.(t)})),T=u.useCallback(()=>{const t={};if(r.startDate||(t.startDate="Start Date can NOT be empty..."),r.endDate||(t.endDate="End Date can NOT be empty..."),r.startDate&&r.endDate){const a=new Date(r.startDate),b=new Date(r.endDate);a>b&&(t.endDate="Start Date cannot be after End Date...")}return c(a=>({...a,validationErrors:t})),Object.keys(t).length===0},[r.startDate,r.endDate]),k=u.useCallback(t=>{c(a=>({...a,reportType:t,validationErrors:{},isConfirmationStep:!1,confirmation:"",showReport:!1}))},[]),w=u.useCallback((t,a)=>{c(b=>({...b,[t]:a,validationErrors:{...b.validationErrors,[t]:""}}))},[]),A=u.useCallback(t=>{c(a=>({...a,confirmation:t,validationErrors:{...a.validationErrors,confirmation:""}}))},[]),W=u.useCallback(async()=>{if(!r.reportType){c(a=>({...a,validationErrors:{reportType:"Please select a report type..."}}));return}if(!r.confirmation||!/^[YyNn]$/.test(r.confirmation)){c(a=>({...a,validationErrors:{confirmation:"Please confirm to generate the report (Y/N)..."}}));return}if(r.confirmation.toUpperCase()==="N"){c(a=>({...a,reportType:null,startDate:"",endDate:"",confirmation:"",validationErrors:{},isConfirmationStep:!1,showReport:!1})),o.onSuccess?.({success:!0,message:"Report generation cancelled by user.",reportType:r.reportType,jobId:"",timestamp:new Date().toISOString()});return}const t={confirmed:!0};try{switch(r.reportType){case"monthly":await m(t);break;case"yearly":await g(t);break;case"custom":if(!T())return;t.startDate=r.startDate,t.endDate=r.endDate,await f(t);break}}catch(a){console.error("Error generating report:",a)}},[r,m,g,f,T,o]),N=u.useCallback(()=>{c({reportType:null,startDate:"",endDate:"",confirmation:"",validationErrors:{},isConfirmationStep:!1,reportData:null,showReport:!1})},[]),v=u.useCallback(()=>{c(t=>({...t,showReport:!1,reportData:null}))},[]),O=u.useCallback(()=>{if(!r.reportData)return;const a=(()=>{let h=`DETAILED TRANSACTION REPORT
`;h+=`Type: ${r.reportData.reportType}
`,h+=`Period: ${r.reportData.startDate} - ${r.reportData.endDate}
`,h+=`Accounts: ${r.reportData.accountCount} | Transactions: ${r.reportData.totalTransactionCount}

`,h+=`${"TRANS ID".padEnd(12)} ${"CARD".padEnd(20)} ${"TYPE".padEnd(6)} ${"TYPE DESC".padEnd(15)} ${"CAT".padEnd(5)} ${"CAT DESC".padEnd(25)} ${"SOURCE".padEnd(12)} ${"AMOUNT".padStart(12)}
`,h+=`${"-".repeat(12)} ${"-".repeat(20)} ${"-".repeat(6)} ${"-".repeat(15)} ${"-".repeat(5)} ${"-".repeat(25)} ${"-".repeat(12)} ${"-".repeat(12)}
`,r.reportData.accountGroups.forEach((z,_)=>{_>0&&(h+=`${"-".repeat(120)}
`),z.transactions.forEach(j=>{const te=j.transactionId.replace(/^0+/,"")||"0",re=j.cardNumber.replace(/(\d{4})(?=\d)/g,"$1 "),ae=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(j.amount);h+=`${te.padEnd(12)} ${re.padEnd(20)} ${j.typeCode.padEnd(6)} ${j.typeDescription.substring(0,15).padEnd(15)} ${j.categoryCode.toString().padStart(3,"0").padEnd(5)} ${j.categoryDescription.substring(0,25).padEnd(25)} ${j.source.substring(0,12).padEnd(12)} ${ae.padStart(12)}
`});const ee=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(z.accountTotal);h+=`ACCOUNT TOTAL (${z.transactionCount} trans): ${ee.padStart(12)}
`});const Z=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r.reportData.grandTotal);return h+=`${"=".repeat(120)}
`,h+=`GRAND TOTAL (${r.reportData.totalTransactionCount} transactions): ${Z.padStart(12)}
`,h})(),b=new Blob([a],{type:"text/plain"}),H=window.URL.createObjectURL(b),S=document.createElement("a");S.href=H,S.download=`transaction-report-${r.reportData.reportType}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(H)},[r.reportData]),P=u.useCallback(()=>{n("/menu/main")},[n]);return{...r,loading:s||i||D,handleReportTypeSelect:k,handleDateChange:w,handleConfirmationChange:A,handleSubmit:W,handleClear:N,handleCloseReport:v,handleDownloadPDF:O,handleExit:P}}function Oe({onSuccess:o,onError:n}){const r=V(),c={...o&&{onSuccess:o},...n&&{onError:n}},{reportType:p,startDate:m,endDate:s,confirmation:g,validationErrors:i,loading:f,reportData:D,showReport:T,handleReportTypeSelect:k,handleDateChange:w,handleConfirmationChange:A,handleSubmit:W,handleClear:N,handleCloseReport:v,handleDownloadPDF:O,handleExit:P}=Ne(c),t=new Date().toISOString().split("T")[0];return T&&D?e.jsxs(ce,{open:T,onClose:v,maxWidth:"xl",fullWidth:!0,PaperProps:{sx:{height:"90vh",maxHeight:"90vh"}},children:[e.jsxs(de,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsxs(d,{variant:"h6",component:"div",children:["Transaction Report - ",D.reportType]}),e.jsx(pe,{onClick:v,size:"small",children:e.jsx(xe,{})})]}),e.jsx(ue,{sx:{p:0,overflow:"hidden"},children:e.jsx(x,{sx:{p:2,height:"100%",overflow:"auto"},children:e.jsx(We,{reportData:D})})}),e.jsxs(he,{sx:{p:2,gap:1},children:[e.jsx(C,{variant:"contained",startIcon:e.jsx(me,{}),onClick:O,color:"primary",children:"Download TXT"}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(ge,{}),onClick:()=>window.print(),children:"Print"}),e.jsx(C,{variant:"outlined",onClick:v,children:"Close"})]})]}):e.jsxs(fe,{maxWidth:"lg",sx:{py:3},children:[e.jsx(ke,{transactionId:"CR00",programName:"CORPT00C",title:"CardDemo - Transaction Reports",subtitle:"Generate Transaction Reports"}),e.jsxs(G,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${y(r.palette.background.paper,.9)}, ${y(r.palette.background.default,.1)})`},children:[e.jsx(x,{sx:{p:3,textAlign:"center",background:`linear-gradient(135deg, ${r.palette.primary.main}, ${r.palette.secondary.main})`,color:"white"},children:e.jsxs(d,{variant:"h5",fontWeight:600,children:[e.jsx(je,{sx:{mr:1,verticalAlign:"middle"}}),"Transaction Reports"]})}),e.jsxs(x,{sx:{p:4},children:[e.jsx(F,{sx:{mb:3,border:`1px solid ${r.palette.divider}`},children:e.jsx(U,{children:e.jsxs(q,{component:"fieldset",fullWidth:!0,children:[e.jsx(ye,{component:"legend",sx:{fontSize:"1.1rem",fontWeight:600,color:"primary.main",mb:2},children:"Select Report Type"}),e.jsxs(X,{value:p||"",onChange:a=>k(a.target.value),children:[e.jsx(E,{value:"monthly",control:e.jsx($,{}),label:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(be,{color:"primary"}),e.jsxs(x,{children:[e.jsx(d,{variant:"body1",fontWeight:500,children:"Monthly (Current Month)"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Generate report for the current month"})]})]}),sx:{mb:1,p:1,borderRadius:1}}),e.jsx(E,{value:"yearly",control:e.jsx($,{}),label:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ce,{color:"primary"}),e.jsxs(x,{children:[e.jsx(d,{variant:"body1",fontWeight:500,children:"Yearly (Current Year)"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Generate report for the current year"})]})]}),sx:{mb:1,p:1,borderRadius:1}}),e.jsx(E,{value:"custom",control:e.jsx($,{}),label:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(De,{color:"primary"}),e.jsxs(x,{children:[e.jsx(d,{variant:"body1",fontWeight:500,children:"Custom (Date Range)"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Generate report for a specific date range"})]})]}),sx:{p:1,borderRadius:1}})]})]})})}),p==="custom"&&e.jsx(F,{sx:{mb:3,border:`1px solid ${r.palette.divider}`},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,color:"primary.main",sx:{mb:3},children:"Date Range Selection"}),e.jsxs(M,{container:!0,spacing:3,children:[e.jsx(M,{item:!0,xs:12,md:6,children:e.jsx(J,{fullWidth:!0,type:"date",label:"Start Date",value:m,onChange:a=>w("startDate",a.target.value),error:!!i.startDate,helperText:i.startDate,InputLabelProps:{shrink:!0},inputProps:{max:t},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),e.jsx(M,{item:!0,xs:12,md:6,children:e.jsx(J,{fullWidth:!0,type:"date",label:"End Date",value:s,onChange:a=>w("endDate",a.target.value),error:!!i.endDate,helperText:i.endDate,InputLabelProps:{shrink:!0},inputProps:{max:t},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})})]})]})}),p&&e.jsx(F,{sx:{mb:3,border:`1px solid ${r.palette.divider}`},children:e.jsxs(U,{children:[e.jsx(d,{variant:"body1",gutterBottom:!0,sx:{mb:2},children:"The Report will be submitted for printing. Please confirm:"}),e.jsx(q,{component:"fieldset",children:e.jsxs(X,{row:!0,value:g,onChange:a=>A(a.target.value),children:[e.jsx(E,{value:"Y",control:e.jsx($,{}),label:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Te,{color:"success",fontSize:"small"}),"Yes"]})}),e.jsx(E,{value:"N",control:e.jsx($,{}),label:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ve,{color:"error",fontSize:"small"}),"No"]})})]})}),i.confirmation&&e.jsx(I,{severity:"error",sx:{mt:2},children:i.confirmation})]})}),Object.keys(i).length>0&&!i.confirmation&&e.jsx(I,{severity:"error",sx:{mb:3},children:"Please correct the errors above before proceeding."}),e.jsx(Se,{sx:{my:3}}),e.jsxs(Re,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"center",children:[e.jsx(C,{variant:"contained",size:"large",startIcon:e.jsx(Ee,{}),onClick:W,disabled:!p||f,sx:{minWidth:150,borderRadius:2,fontWeight:600},children:f?"Processing...":"Generate Report"}),e.jsx(C,{variant:"outlined",size:"large",startIcon:e.jsx($e,{}),onClick:N,disabled:f,sx:{minWidth:150,borderRadius:2,fontWeight:600},children:"Clear"}),e.jsx(C,{variant:"outlined",size:"large",startIcon:e.jsx(we,{}),onClick:P,disabled:f,sx:{minWidth:150,borderRadius:2,fontWeight:600},children:"Exit (F3)"})]})]})]})]})}function Ye(){const[o,n]=u.useState(null),[r,c]=u.useState(null),p=s=>{s.success?n(s.message):c(s.message)},m=s=>{c(s)};return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{onSuccess:p,onError:m}),e.jsx(K,{open:!!o,autoHideDuration:6e3,onClose:()=>n(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(I,{onClose:()=>n(null),severity:"success",variant:"filled",sx:{width:"100%"},children:o})}),e.jsx(K,{open:!!r,autoHideDuration:6e3,onClose:()=>c(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(I,{onClose:()=>c(null),severity:"error",variant:"filled",sx:{width:"100%"},children:r})})]})}export{Ye as default};
