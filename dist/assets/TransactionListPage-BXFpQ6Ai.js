import{u as U,j as e,a as _,B as g,P as L,g as y,aC as z,b as u,S as k,v as K,G as M,i as H,k as Y,d as w,af as G,ag as X,ah as Z,ai as W,aj as l,X as J,Z as Q,ak as ee,f as ae,I as re,m as se,A as N,at as ne,al as te,am as ie,y as oe,aB as O}from"./mui-bVcw8cZ8.js";import{r as t}from"./vendor-BPyidg2q.js";import{S as ce}from"./SystemHeader-DB4NlgIL.js";import{u as $}from"./useApi-EeZ7am_M.js";import{g as B}from"./index-85Pf7yId.js";import{u as q}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";function le(i={}){const c=q(),[s,o]=t.useState({searchTransactionId:"",currentPage:1,transactions:[],selectedTransaction:null,hasNextPage:!1,hasPreviousPage:!1}),[p,d]=t.useState({}),x=t.useRef(!1),f=t.useCallback(a=>({onSuccess:a,...i.onError&&{onError:i.onError}}),[i.onError]),{mutate:T,loading:E,error:m}=$(async a=>await B.post("/transactions/list",a),f(a=>{if(a.errorMessage){d({searchTransactionId:a.errorMessage});return}o(r=>{const n={...r,transactions:a.transactions||[],currentPage:a.currentPage||1,hasNextPage:a.hasNextPage||!1,hasPreviousPage:a.hasPreviousPage||!1};return a.firstTransactionId&&(n.firstTransactionId=a.firstTransactionId),a.lastTransactionId&&(n.lastTransactionId=a.lastTransactionId),n}),d({})})),{mutate:h,loading:P}=$(async a=>await B.post("/transactions/next-page",a),f(a=>{if(a.errorMessage){i.onError?.(a.errorMessage);return}o(r=>{const n={...r,transactions:a.transactions||[],currentPage:a.currentPage||r.currentPage+1,hasNextPage:a.hasNextPage||!1,hasPreviousPage:a.hasPreviousPage||!0};return a.firstTransactionId&&(n.firstTransactionId=a.firstTransactionId),a.lastTransactionId&&(n.lastTransactionId=a.lastTransactionId),n})})),{mutate:v,loading:C}=$(async a=>await B.post("/transactions/previous-page",a),f(a=>{if(a.errorMessage){i.onError?.(a.errorMessage);return}o(r=>{const n={...r,transactions:a.transactions||[],currentPage:a.currentPage||r.currentPage-1,hasNextPage:a.hasNextPage||!0,hasPreviousPage:a.hasPreviousPage||!1};return a.firstTransactionId&&(n.firstTransactionId=a.firstTransactionId),a.lastTransactionId&&(n.lastTransactionId=a.lastTransactionId),n})})),j=t.useCallback(a=>{const r={};return a&&!/^\d+$/.test(a)&&(r.searchTransactionId="Tran ID must be Numeric ..."),d(r),Object.keys(r).length===0},[]),I=t.useCallback(async()=>{if(!j(s.searchTransactionId))return;const a={pageNumber:1};s.searchTransactionId.trim()&&(a.transactionId=s.searchTransactionId),await T(a)},[s.searchTransactionId,j,T]),F=t.useCallback((a,r)=>{r.toUpperCase()==="S"?(o(n=>({...n,selectedTransaction:a})),i.onTransactionSelect?.(a),c(`/transactions/view/${a}`)):d({[`selection_${a}`]:"Invalid selection. Valid value is S"})},[c,i.onTransactionSelect]),b=t.useCallback(async()=>{if(!s.hasNextPage){i.onError?.("You are already at the bottom of the page...");return}const a={pageNumber:s.currentPage};s.lastTransactionId&&(a.transactionId=s.lastTransactionId),await h(a)},[s.hasNextPage,s.lastTransactionId,s.currentPage,h,i.onError]),S=t.useCallback(async()=>{if(!s.hasPreviousPage){i.onError?.("You are already at the top of the page...");return}const a={pageNumber:s.currentPage};s.firstTransactionId&&(a.transactionId=s.firstTransactionId),await v(a)},[s.hasPreviousPage,s.firstTransactionId,s.currentPage,v,i.onError]),D=t.useCallback(a=>{o(r=>({...r,searchTransactionId:a})),p.searchTransactionId&&d(r=>({...r,searchTransactionId:""}))},[p.searchTransactionId]),R=t.useCallback(()=>{c("/menu/main")},[c]),A=t.useCallback(async()=>{if(x.current||s.transactions.length>0)return;x.current=!0,await T({pageNumber:1})},[T,s.transactions.length]);return{...s,validationErrors:p,loading:E||P||C,error:m,handleSearch:I,handleTransactionSelect:F,handleNextPage:b,handlePreviousPage:S,handleSearchChange:D,handleExit:R,handleInitialLoad:A}}function de({onTransactionSelect:i,onError:c}){const s=U(),[o,p]=t.useState({}),{searchTransactionId:d,currentPage:x,transactions:f,hasNextPage:T,hasPreviousPage:E,validationErrors:m,loading:h,error:P,handleSearch:v,handleTransactionSelect:C,handleNextPage:j,handlePreviousPage:I,handleSearchChange:F,handleExit:b,handleInitialLoad:S}=le({...i&&{onTransactionSelect:i},...c&&{onError:c}});t.useEffect(()=>{S()},[S]);const D=t.useCallback(r=>{r.key==="F3"?(r.preventDefault(),b()):r.key==="F7"?(r.preventDefault(),I()):r.key==="F8"&&(r.preventDefault(),j())},[b,I,j]),R=t.useCallback((r,n)=>{p(V=>({...V,[r]:n.toUpperCase()}))},[]),A=t.useCallback(r=>{const n=o[r];n&&C(r,n)},[o,C]),a=t.useCallback(r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r),[]);return e.jsx(_,{maxWidth:"xl",sx:{py:3},children:e.jsxs(g,{onKeyDown:D,tabIndex:-1,children:[e.jsx(ce,{transactionId:"CT00",programName:"COTRN00C",title:"List Transactions",subtitle:"CardDemo - Transaction Management"}),e.jsxs(L,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${y(s.palette.background.paper,.9)}, ${y(s.palette.background.default,.1)})`},children:[e.jsxs(g,{sx:{p:3,textAlign:"center",background:`linear-gradient(135deg, ${s.palette.primary.main}, ${s.palette.secondary.main})`,color:"white"},children:[e.jsx(z,{sx:{fontSize:48,mb:2}}),e.jsx(u,{variant:"h5",fontWeight:600,children:"List Transactions"}),e.jsx(k,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{mt:2},children:e.jsx(K,{label:`Page: ${x}`,variant:"filled",sx:{bgcolor:"rgba(255,255,255,0.2)",color:"white",fontWeight:600}})})]}),e.jsxs(g,{sx:{p:4},children:[e.jsxs(g,{sx:{mb:4},children:[e.jsxs(u,{variant:"h6",color:"primary.main",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{}),"Search Transaction"]}),e.jsxs(k,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(H,{label:"Search Tran ID",value:d,onChange:r=>F(r.target.value),error:!!m.searchTransactionId,helperText:m.searchTransactionId||"Enter numeric Transaction ID",disabled:h,placeholder:"Enter Transaction ID",inputProps:{maxLength:16,style:{fontFamily:"monospace"}},InputProps:{startAdornment:e.jsx(Y,{position:"start",children:e.jsx(M,{color:"primary"})})},sx:{flex:1,maxWidth:300,"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsx(w,{variant:"contained",onClick:v,disabled:h,startIcon:e.jsx(M,{}),sx:{borderRadius:2,px:3,py:1.5},children:"Search"})]})]}),e.jsx(G,{component:L,variant:"outlined",sx:{borderRadius:2,mb:3,maxHeight:600},children:e.jsxs(X,{stickyHeader:!0,children:[e.jsx(Z,{children:e.jsxs(W,{children:[e.jsx(l,{sx:{fontWeight:600,bgcolor:"primary.main",color:"primary.contrastText"},children:"Sel"}),e.jsx(l,{sx:{fontWeight:600,bgcolor:"primary.main",color:"primary.contrastText"},children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{fontSize:"small"}),"Transaction ID"]})}),e.jsx(l,{sx:{fontWeight:600,bgcolor:"primary.main",color:"primary.contrastText"},children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(J,{fontSize:"small"}),"Date"]})}),e.jsx(l,{sx:{fontWeight:600,bgcolor:"primary.main",color:"primary.contrastText"},children:"Description"}),e.jsx(l,{sx:{fontWeight:600,bgcolor:"primary.main",color:"primary.contrastText",textAlign:"right"},children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"flex-end"},children:[e.jsx(Q,{fontSize:"small"}),"Amount"]})})]})}),e.jsx(ee,{children:f.length===0?e.jsx(W,{children:e.jsx(l,{colSpan:5,sx:{textAlign:"center",py:4},children:e.jsx(u,{variant:"body1",color:"text.secondary",children:h?"Loading transactions...":"No transactions found"})})}):f.map(r=>e.jsxs(W,{sx:{"&:hover":{bgcolor:y(s.palette.primary.main,.05)},"&:nth-of-type(odd)":{bgcolor:y(s.palette.grey[100],.5)}},children:[e.jsxs(l,{children:[e.jsxs(k,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(H,{size:"small",value:o[r.transactionId]||"",onChange:n=>R(r.transactionId,n.target.value),error:!!m[`selection_${r.transactionId}`],placeholder:"S",inputProps:{maxLength:1,style:{textAlign:"center",textTransform:"uppercase",width:"30px"}},sx:{width:60}}),e.jsx(ae,{title:"View Details",children:e.jsx(re,{size:"small",onClick:()=>A(r.transactionId),disabled:!o[r.transactionId],color:"primary",children:e.jsx(se,{fontSize:"small"})})})]}),m[`selection_${r.transactionId}`]&&e.jsx(u,{variant:"caption",color:"error",display:"block",children:m[`selection_${r.transactionId}`]})]}),e.jsx(l,{children:e.jsx(u,{variant:"body2",fontFamily:"monospace",fontWeight:600,children:r.transactionId})}),e.jsx(l,{children:e.jsx(u,{variant:"body2",fontFamily:"monospace",children:r.date})}),e.jsx(l,{children:e.jsx(u,{variant:"body2",sx:{maxWidth:300},children:r.description})}),e.jsx(l,{sx:{textAlign:"right"},children:e.jsx(u,{variant:"body2",fontFamily:"monospace",fontWeight:600,color:r.amount<0?"error.main":"success.main",children:a(r.amount)})})]},r.transactionId))})]})}),e.jsx(N,{severity:"info",sx:{mb:3,borderRadius:2},icon:e.jsx(ne,{}),children:"Type 'S' to View Transaction details from the list"}),P&&e.jsx(N,{severity:"error",sx:{mb:3,borderRadius:2},children:P}),e.jsxs(k,{direction:"row",spacing:2,justifyContent:"center",flexWrap:"wrap",children:[e.jsx(w,{variant:"outlined",onClick:I,disabled:h||!E,startIcon:e.jsx(te,{}),sx:{borderRadius:2,px:3},children:"F7 = Backward"}),e.jsx(w,{variant:"outlined",onClick:j,disabled:h||!T,startIcon:e.jsx(ie,{}),sx:{borderRadius:2,px:3},children:"F8 = Forward"}),e.jsx(w,{variant:"outlined",color:"error",onClick:b,disabled:h,startIcon:e.jsx(oe,{}),sx:{borderRadius:2,px:3},children:"F3 = Back"})]})]}),e.jsx(g,{sx:{p:2,bgcolor:y(s.palette.grey[100],.5),borderTop:`1px solid ${s.palette.divider}`,textAlign:"center"},children:e.jsx(u,{variant:"body2",color:"text.secondary",children:"ENTER = Continue • F3 = Back • F7 = Backward • F8 = Forward"})})]})]})})}function Te(){q();const[i,c]=t.useState(null),[s,o]=t.useState(null),p=x=>{c(`Navigating to transaction details: ${x}`)},d=x=>{o(x)};return e.jsxs(e.Fragment,{children:[e.jsx(de,{onTransactionSelect:p,onError:d}),e.jsx(O,{open:!!i,autoHideDuration:4e3,onClose:()=>c(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(N,{onClose:()=>c(null),severity:"success",variant:"filled",sx:{width:"100%"},children:i})}),e.jsx(O,{open:!!s,autoHideDuration:6e3,onClose:()=>o(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(N,{onClose:()=>o(null),severity:"error",variant:"filled",sx:{width:"100%"},children:s})})]})}export{Te as default};
