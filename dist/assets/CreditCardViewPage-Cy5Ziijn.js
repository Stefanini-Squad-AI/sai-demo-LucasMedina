import{u as ee,j as e,a as re,B as l,P as $,g,b as s,h as M,N as c,i as H,k as J,d as D,G as te,A as S,J as ae,S as w,v as k,U as P,W as V,D as B,l as se,X as ne,K as oe,y as ce,an as K,ao as ie,ap as de,ab as le}from"./mui-bVcw8cZ8.js";import{r as i}from"./vendor-BPyidg2q.js";import{S as ue}from"./SystemHeader-DB4NlgIL.js";import{g as xe,L as me}from"./index-85Pf7yId.js";import{u as he}from"./useApi-EeZ7am_M.js";import{u as X,a as be}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";function pe(x={}){const o=X(),[y,d]=i.useState({}),{mutate:m,loading:C,error:b,data:A}=he(async n=>{const r=parseInt(n.accountId,10);console.log("ðŸ”„ Converting request:",{original:n,converted:{accountId:r,cardNumber:n.cardNumber}});const u={accountId:r,cardNumber:n.cardNumber},a=await xe.post("/credit-cards/details",u);if(console.log("ðŸŽ¯ API Response received:",a),a&&typeof a=="object"&&"success"in a&&"data"in a){if(a.success&&a.data)return console.log("ðŸ“¦ Returning ApiResponse.data:",a.data),a.data;throw console.error("âŒ ApiResponse failed:",a.error),new Error(a.error||"Request failed")}if(a&&typeof a=="object"&&"accountId"in a&&"cardNumber"in a){if("success"in a&&a.success===!1){console.error("âŒ MSW error response:",a);const f=a.errorMessage||"Request failed";throw new Error(f)}return console.log("ðŸ“¦ Returning direct MSW response:",a),a}throw console.error("âŒ Invalid response structure:",a),new Error("Invalid response structure")},{onSuccess:n=>{console.log("âœ… useMutation onSuccess called with:",n),n&&x.onSuccess&&x.onSuccess(n)},onError:n=>{console.error("âŒ useMutation onError called with:",n),x.onError&&x.onError(n)}}),E=i.useCallback(n=>{const r={};return!n.accountId||n.accountId.trim()===""?r.accountId="Account number not provided":(!/^\d{11}$/.test(n.accountId)||n.accountId==="00000000000")&&(r.accountId="Account number must be a non zero 11 digit number"),!n.cardNumber||n.cardNumber.trim()===""?r.cardNumber="Card number not provided":/^\d{16}$/.test(n.cardNumber)||(r.cardNumber="Card number if supplied must be a 16 digit number"),d(r),Object.keys(r).length===0},[]),T=i.useCallback(async n=>{if(console.log("ðŸ” handleSearch called with:",n),!E(n)){console.log("âŒ Validation failed");return}console.log("âœ… Validation passed, calling fetchCardDetail");try{await m(n)}catch(r){console.error("âŒ Error in handleSearch:",r)}},[m,E]),p=i.useCallback(()=>{o("/cards/list")},[o]),h=i.useCallback((n,r)=>({month:n||"",year:r||""}),[]);return console.log("ðŸŽ¯ useCreditCardDetail state:",{data:A,loading:C,error:b,validationErrors:y}),{data:A,loading:C,error:b||(Object.keys(y).length>0?"Please correct the validation errors":null),validationErrors:y,handleSearch:T,handleExit:p,formatExpiryDate:h}}function ge({onExit:x}){const o=ee(),d=be().state,[m,C]=i.useState({accountId:d?.accountNumber||"",cardNumber:d?.cardNumber||""}),[b,A]=i.useState(!1),[E,T]=i.useState(!1),p=i.useRef(!1),h=i.useRef(!1),n=[{accountId:"12345678901",cardNumber:"4532123456789012",description:"Active Card - John Smith - Premium",status:"Active",holderName:"JOHN SMITH"},{accountId:"12345678901",cardNumber:"4532123456789013",description:"Inactive Card - Jane Smith - Standard",status:"Inactive",holderName:"JANE SMITH"},{accountId:"98765432109",cardNumber:"5555666677778888",description:"Active Card - Robert Johnson - Platinum",status:"Active",holderName:"ROBERT JOHNSON"},{accountId:"11111111111",cardNumber:"4111111111111111",description:"Expired Card - Maria Garcia - Basic",status:"Expired",holderName:"MARIA GARCIA"},{accountId:"22222222222",cardNumber:"4222222222222222",description:"Active Premium - Alice Brown - Gold",status:"Active",holderName:"ALICE BROWN"},{accountId:"33333333333",cardNumber:"4333333333333333",description:"High Volume Account - David Wilson",status:"Active",holderName:"DAVID WILSON"}],{data:r,loading:u,error:a,validationErrors:f,handleSearch:j,handleExit:W,formatExpiryDate:G}=pe({onError:t=>{console.error("âŒ Credit card detail error:",t),h.current=!0},onSuccess:t=>{console.log("âœ… Credit card detail loaded successfully:",t.cardNumber),h.current=!0}});i.useEffect(()=>{if(console.log("ðŸ”„ useEffect triggered:",{hasState:!!(d?.accountNumber&&d?.cardNumber),hasAutoSearched:p.current,searchAttempted:h.current,loading:u,hasData:!!r,hasError:!!a}),d?.accountNumber&&d?.cardNumber&&!p.current&&!h.current&&!u){console.log("ðŸš€ Starting auto-search..."),A(!0),p.current=!0;const t={accountId:d.accountNumber,cardNumber:d.cardNumber};console.log("ðŸ” Auto-searching with data:",t),j(t)}},[d?.accountNumber,d?.cardNumber,u]),i.useEffect(()=>()=>{p.current=!1,h.current=!1},[]);const F=i.useCallback(t=>v=>{const I=v.target.value;let N=I;t==="accountId"&&I.length>11?N=I.slice(0,11):t==="cardNumber"&&I.length>16&&(N=I.slice(0,16)),(t==="accountId"||t==="cardNumber")&&(N=N.replace(/\D/g,"")),C(q=>({...q,[t]:N}))},[]),U=i.useCallback(t=>{t.preventDefault(),console.log("ðŸ“ Manual search submitted:",m),h.current=!1,j(m)},[m,j]),Y=i.useCallback(t=>{const v={accountId:t.accountId,cardNumber:t.cardNumber};C(v),h.current=!1,p.current=!1,j(v),T(!1)},[j]),Q=i.useCallback(()=>{console.log("ðŸ”„ Retrying search..."),h.current=!1,p.current=!1;const t={accountId:d?.accountNumber||m.accountId,cardNumber:d?.cardNumber||m.cardNumber};j(t)},[d,m,j]),Z=i.useCallback(t=>{(t.key==="F3"||t.key==="Escape")&&(t.preventDefault(),x?x():W())},[x,W]),L=t=>{switch(t){case"ACTIVE":return"success";case"INACTIVE":return"default";case"BLOCKED":return"error";case"EXPIRED":return"warning";default:return"default"}},O=t=>{switch(t){case"ACTIVE":return"Active";case"INACTIVE":return"Inactive";case"BLOCKED":return"Blocked";case"EXPIRED":return"Expired";default:return"Unknown"}},z=t=>{switch(t){case"ACTIVE":return e.jsx(le,{});case"INACTIVE":return e.jsx(K,{});case"BLOCKED":return e.jsx(de,{});case"EXPIRED":return e.jsx(ie,{});default:return e.jsx(K,{})}},_=t=>{switch(t){case"Active":return"success";case"Inactive":return"default";case"Expired":return"warning";case"Blocked":return"error";default:return"default"}},R=G(r?.expiryMonth,r?.expiryYear);return console.log("ðŸŽ¯ Component render state:",{data:r,loading:u,error:a,validationErrors:f}),e.jsx(re,{maxWidth:"lg",sx:{py:3},children:e.jsxs(l,{onKeyDown:Z,tabIndex:-1,children:[e.jsx(ue,{transactionId:"CCDL",programName:"COCRDSLC",title:"View Credit Card Detail"}),e.jsxs($,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${g(o.palette.background.paper,.9)}, ${g(o.palette.background.default,.1)})`},children:[e.jsx(l,{sx:{p:3,textAlign:"center",background:`linear-gradient(135deg, ${o.palette.primary.main}, ${o.palette.secondary.main})`,color:"white"},children:e.jsxs(s,{variant:"h5",fontWeight:600,children:[e.jsx(M,{sx:{mr:1,verticalAlign:"middle"}}),"View Credit Card Detail"]})}),e.jsxs(l,{sx:{p:3},children:[e.jsxs(l,{component:"form",onSubmit:U,sx:{mb:3},children:[e.jsxs(c,{container:!0,spacing:3,alignItems:"flex-end",children:[e.jsx(c,{item:!0,xs:12,md:5,children:e.jsx(H,{label:"Account Number",value:m.accountId,onChange:F("accountId"),error:!!f.accountId,helperText:f.accountId||"11 digits required",disabled:u||b,fullWidth:!0,inputProps:{maxLength:11,pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"#"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,...b&&{bgcolor:g(o.palette.info.main,.1)}}}})}),e.jsx(c,{item:!0,xs:12,md:5,children:e.jsx(H,{label:"Card Number",value:m.cardNumber,onChange:F("cardNumber"),error:!!f.cardNumber,helperText:f.cardNumber||"16 digits required",disabled:u||b,fullWidth:!0,inputProps:{maxLength:16,pattern:"[0-9]*"},InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(M,{fontSize:"small",color:"action"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,...b&&{bgcolor:g(o.palette.info.main,.1)}}}})}),e.jsx(c,{item:!0,xs:12,md:2,children:e.jsx(D,{type:"submit",variant:"contained",disabled:u||b,startIcon:u?e.jsx(me,{size:20}):e.jsx(te,{}),fullWidth:!0,sx:{borderRadius:2,py:1.5},children:u?"Searching...":"Search"})})]}),b&&e.jsx(S,{severity:"info",sx:{mt:2,borderRadius:2},children:"Search criteria populated from card selection. Data loaded automatically."})]}),!1,e.jsx(ae,{in:E,children:e.jsxs($,{variant:"outlined",sx:{p:2,mb:3,bgcolor:g(o.palette.info.main,.05),borderColor:o.palette.info.main},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,color:"info.main",fontWeight:600,children:"Test Credit Cards (Development Only)"}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"Click on any card to view its details"}),e.jsx(c,{container:!0,spacing:1,children:n.map((t,v)=>e.jsx(c,{item:!0,xs:12,children:e.jsx(D,{variant:"text",onClick:()=>Y(t),sx:{justifyContent:"flex-start",textAlign:"left",width:"100%",p:2,border:`1px solid ${o.palette.divider}`,borderRadius:1,bgcolor:"background.paper",textTransform:"none","&:hover":{bgcolor:g(o.palette.primary.main,.05)}},children:e.jsxs(c,{container:!0,spacing:2,alignItems:"center",sx:{width:"100%"},children:[e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(w,{spacing:.5,children:[e.jsxs(s,{variant:"body2",fontWeight:600,color:"primary.main",children:["Account: ",t.accountId]}),e.jsxs(s,{variant:"body2",fontWeight:600,color:"secondary.main",sx:{fontFamily:"monospace"},children:["Card: ",t.cardNumber]})]})}),e.jsxs(c,{item:!0,xs:12,sm:5,children:[e.jsx(s,{variant:"body2",fontWeight:500,children:t.description}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Holder: ",t.holderName]})]}),e.jsx(c,{item:!0,xs:12,sm:3,children:e.jsx(k,{label:t.status,size:"small",color:_(t.status),variant:"outlined"})})]})})},v))}),e.jsx(l,{sx:{mt:2,p:2,bgcolor:g(o.palette.warning.main,.1),borderRadius:1},children:e.jsxs(s,{variant:"caption",color:"text.secondary",children:[e.jsx("strong",{children:"Testing Tips:"}),e.jsx("br",{}),"â€¢ Each test card has different status and expiry dates",e.jsx("br",{}),"â€¢ Use these cards to test various scenarios",e.jsx("br",{}),"â€¢ All test data is for development purposes only",e.jsx("br",{}),"â€¢ Real production data will have different validation rules"]})})]})}),a&&e.jsx(S,{severity:"error",sx:{mb:3,borderRadius:2},action:e.jsx(D,{color:"inherit",size:"small",onClick:Q,disabled:u,children:"Retry"}),children:a}),r&&!r.success&&r.errorMessage&&e.jsx(S,{severity:"error",sx:{mb:3,borderRadius:2},children:r.errorMessage}),!r&&!u&&!a&&e.jsx(S,{severity:"info",sx:{mb:3,borderRadius:2},children:"Please enter Account and Card Number"}),r&&r.success&&e.jsxs(e.Fragment,{children:[r.infoMessage&&e.jsx(S,{severity:"success",sx:{mb:3,borderRadius:2},children:r.infoMessage}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(P,{elevation:1,sx:{height:"100%"},children:e.jsxs(V,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,color:"primary.main",children:[e.jsx(M,{sx:{mr:1,verticalAlign:"middle"}}),"Card Information"]}),e.jsx(B,{sx:{mb:2}}),e.jsxs(w,{spacing:2.5,children:[e.jsxs(l,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Account Number:"}),e.jsx(s,{variant:"h6",fontFamily:"monospace",fontWeight:600,children:r.accountId.toString().padStart(11,"0")})]}),e.jsxs(l,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Card Number:"}),e.jsx(s,{variant:"h6",fontFamily:"monospace",fontWeight:600,children:r.cardNumber})]}),e.jsxs(l,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Card Active:"}),e.jsx(k,{label:O(r.activeStatus),color:L(r.activeStatus),icon:z(r.activeStatus),variant:"filled",sx:{fontWeight:600}})]})]})]})})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(P,{elevation:1,sx:{height:"100%"},children:e.jsxs(V,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,color:"primary.main",children:[e.jsx(se,{sx:{mr:1,verticalAlign:"middle"}}),"Cardholder Details"]}),e.jsx(B,{sx:{mb:2}}),e.jsxs(w,{spacing:2.5,children:[e.jsxs(l,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Name on Card:"}),e.jsx(s,{variant:"h6",fontWeight:500,children:r.embossedName||"N/A"})]}),e.jsxs(l,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(ne,{sx:{fontSize:16,mr:.5}}),"Expiry Date:"]}),e.jsx(s,{variant:"h6",fontWeight:500,sx:{fontFamily:"monospace"},children:R.month&&R.year?`${R.month}/${R.year}`:"N/A"})]}),r.cvvCode&&e.jsxs(l,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"CVV Code:"}),e.jsx(s,{variant:"body1",fontFamily:"monospace",fontWeight:500,children:"***"})]})]})]})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(P,{elevation:1,children:e.jsxs(V,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,color:"primary.main",children:"Security Information"}),e.jsx(B,{sx:{mb:2}}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(l,{sx:{textAlign:"center",p:2},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Card Status"}),e.jsx(k,{label:O(r.activeStatus),color:L(r.activeStatus),icon:z(r.activeStatus),variant:"filled",size:"medium",sx:{fontWeight:600,fontSize:"1rem",px:2,py:1,height:40}})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(l,{sx:{textAlign:"center",p:2},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Expiry Status"}),e.jsx(k,{label:r.activeStatus==="EXPIRED"?"Expired":"Valid",color:r.activeStatus==="EXPIRED"?"error":"success",variant:"outlined",sx:{fontWeight:600}})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(l,{sx:{textAlign:"center",p:2},children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Security Code"}),e.jsx(s,{variant:"h6",fontFamily:"monospace",color:"text.primary",children:r.cvvCode?"***":"N/A"})]})})]})]})})})]})]})]}),e.jsx(l,{sx:{p:2,bgcolor:g(o.palette.grey[100],.5),borderTop:`1px solid ${o.palette.divider}`},children:e.jsxs(w,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsxs(s,{variant:"body2",color:"text.secondary",children:[e.jsx(oe,{sx:{fontSize:16,mr:.5,verticalAlign:"middle"}}),"ENTER = Search Cards"]}),e.jsx(D,{variant:"outlined",size:"small",startIcon:e.jsx(ce,{}),onClick:x||W,disabled:u,sx:{borderRadius:2},children:"F3 = Exit"})]})})]})]})})}function Se(){const x=X();i.useEffect(()=>{if(!localStorage.getItem("userRole")){x("/login");return}},[x]);const o=()=>{x("/cards/list")};return e.jsx(ge,{onExit:o})}export{Se as default};
