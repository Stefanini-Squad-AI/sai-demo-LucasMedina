import{u as H,j as t,a as W,B as x,P as G,g as P,Z as O,b as d,z as k,f as U,I as z,at as K,N as o,D as w,au as V,A as S,a4 as X,S as J,d as M,ab as Q,a8 as _,ae as q,y as tt,i as at,k as m,h as rt,av as et,aw as nt,ax as ot,X as F,ay as st,az as it,aA as ct,aB as Z}from"./mui-bVcw8cZ8.js";import{r as s}from"./vendor-BPyidg2q.js";import{S as lt}from"./SystemHeader-DB4NlgIL.js";import{u as dt}from"./useApi-EeZ7am_M.js";import{g as mt}from"./index-85Pf7yId.js";import{u as Y}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";function pt(C={}){const u=Y(),[n,l]=s.useState({formData:{accountId:"",cardNumber:"",transactionTypeCode:"",transactionCategoryCode:"",transactionSource:"",transactionDescription:"",transactionAmount:"",originalDate:"",processDate:"",merchantId:"",merchantName:"",merchantCity:"",merchantZip:"",confirmation:""},validationErrors:{},isConfirmationStep:!1}),{mutate:f,loading:D,error:g}=dt(async a=>{const r={...a.accountId&&{accountId:a.accountId},...a.cardNumber&&{cardNumber:a.cardNumber},transactionTypeCode:a.transactionTypeCode,transactionCategoryCode:a.transactionCategoryCode,transactionSource:a.transactionSource,transactionDescription:a.transactionDescription,transactionAmount:parseFloat(a.transactionAmount),originalDate:new Date(a.originalDate+"T00:00:00.000Z").toISOString(),processDate:new Date(a.processDate+"T00:00:00.000Z").toISOString(),merchantId:a.merchantId,merchantName:a.merchantName,merchantCity:a.merchantCity,merchantZip:a.merchantZip,confirmation:a.confirmation};console.log("ðŸ”„ Sending to backend:",r);const i=await mt.post("/transactions",r);return console.log("ðŸ“¦ Backend response:",i),i},{onSuccess:a=>{console.log("âœ… Transaction add success:",a),a.success&&l(r=>({...r,formData:{accountId:"",cardNumber:"",transactionTypeCode:"",transactionCategoryCode:"",transactionSource:"",transactionDescription:"",transactionAmount:"",originalDate:"",processDate:"",merchantId:"",merchantName:"",merchantCity:"",merchantZip:"",confirmation:""},validationErrors:{},isConfirmationStep:!1})),C.onSuccess?.(a)},onError:a=>{console.error("âŒ Transaction add error:",a),C.onError?.(a)}}),A=s.useCallback(a=>{const r={};if(!a.accountId&&!a.cardNumber&&(r.accountId="Account or Card Number must be entered..."),a.accountId&&(/^\d{1,11}$/.test(a.accountId)||(r.accountId="Account ID must be Numeric...")),a.cardNumber&&(/^\d{1,16}$/.test(a.cardNumber)||(r.cardNumber="Card Number must be Numeric...")),a.transactionTypeCode?/^\d{1,2}$/.test(a.transactionTypeCode)||(r.transactionTypeCode="Type CD must be Numeric..."):r.transactionTypeCode="Type CD can NOT be empty...",a.transactionCategoryCode?/^\d{1,4}$/.test(a.transactionCategoryCode)||(r.transactionCategoryCode="Category CD must be Numeric..."):r.transactionCategoryCode="Category CD can NOT be empty...",a.transactionSource||(r.transactionSource="Source can NOT be empty..."),a.transactionDescription||(r.transactionDescription="Description can NOT be empty..."),!a.transactionAmount)r.transactionAmount="Amount can NOT be empty...";else{const i=parseFloat(a.transactionAmount);(isNaN(i)||i<-9999999999e-2||i>9999999999e-2)&&(r.transactionAmount="Amount should be in format -99999999.99")}return a.originalDate||(r.originalDate="Orig Date can NOT be empty..."),a.processDate||(r.processDate="Proc Date can NOT be empty..."),a.merchantId?/^\d+$/.test(a.merchantId)||(r.merchantId="Merchant ID must be Numeric..."):r.merchantId="Merchant ID can NOT be empty...",a.merchantName||(r.merchantName="Merchant Name can NOT be empty..."),a.merchantCity||(r.merchantCity="Merchant City can NOT be empty..."),a.merchantZip||(r.merchantZip="Merchant Zip can NOT be empty..."),l(i=>({...i,validationErrors:r})),Object.keys(r).length===0},[]),L=s.useCallback((a,r)=>{l(i=>({...i,formData:{...i.formData,[a]:r},validationErrors:{...i.validationErrors,[a]:""}}))},[]),T=s.useCallback(async()=>{if(A(n.formData)){if(!n.isConfirmationStep){l(a=>({...a,isConfirmationStep:!0}));return}if(!n.formData.confirmation||!/^[YyNn]$/.test(n.formData.confirmation)){l(a=>({...a,validationErrors:{confirmation:"Invalid value. Valid values are (Y/N)..."}}));return}if(n.formData.confirmation.toUpperCase()!=="Y"){l(a=>({...a,validationErrors:{confirmation:"Confirm to add this transaction..."}}));return}try{await f(n.formData)}catch(a){console.error("Error in handleSubmit:",a)}}},[n.formData,n.isConfirmationStep,A,f]),b=s.useCallback(()=>{l(a=>({...a,validationErrors:{accountId:"Copy last transaction feature not available yet"}}))},[]),I=s.useCallback(()=>{l(a=>({...a,formData:{accountId:"",cardNumber:"",transactionTypeCode:"",transactionCategoryCode:"",transactionSource:"",transactionDescription:"",transactionAmount:"",originalDate:"",processDate:"",merchantId:"",merchantName:"",merchantCity:"",merchantZip:"",confirmation:""},validationErrors:{},isConfirmationStep:!1}))},[]),h=s.useCallback(()=>{u("/menu/main")},[u]);return{formData:n.formData,validationErrors:n.validationErrors,isConfirmationStep:n.isConfirmationStep,loading:D,error:g,handleFieldChange:L,handleSubmit:T,handleCopyLastTransaction:b,handleClearForm:I,handleExit:h,canCopyLast:!1}}function ut({onSuccess:C,onError:u}){const n=H(),[l,f]=s.useState(!1),[D,g]=s.useState(!1),[A,L]=s.useState(!1),{formData:T,validationErrors:b,isConfirmationStep:I,loading:h,error:a,handleFieldChange:r,handleSubmit:i,handleCopyLastTransaction:R,handleClearForm:N,handleExit:E,canCopyLast:B}=pt({onSuccess:e=>{e.success&&e.transactionId&&C?.(e.transactionId)},onError:e=>u?.(e)}),p=()=>{const e=new Date,y=e.getFullYear(),j=String(e.getMonth()+1).padStart(2,"0"),v=String(e.getDate()).padStart(2,"0");return`${y}-${j}-${v}`};p(),p(),p(),p(),p(),p(),p(),p(),p(),p();const $=s.useCallback(e=>{e.key==="F3"?(e.preventDefault(),E()):e.key==="F4"?(e.preventDefault(),N()):e.key==="F5"&&(e.preventDefault(),R())},[E,N,R]);s.useCallback(e=>{Object.entries(e).forEach(([y,j])=>{r(y,j)}),f(!1)},[r]),s.useCallback((e,y)=>{r(e,y)},[r]);const c=(e,y,j={})=>t.jsx(at,{label:y,value:T[e],onChange:v=>r(e,v.target.value),error:!!b[e],helperText:b[e],disabled:h,fullWidth:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},...j});return t.jsx(W,{maxWidth:"lg",sx:{py:3},children:t.jsxs(x,{onKeyDown:$,tabIndex:-1,children:[t.jsx(lt,{transactionId:"CT02",programName:"COTRN02C",title:"Add Transaction",subtitle:"CardDemo - Transaction Management"}),t.jsxs(G,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${P(n.palette.background.paper,.9)}, ${P(n.palette.background.default,.1)})`},children:[t.jsxs(x,{sx:{p:3,textAlign:"center",background:`linear-gradient(135deg, ${n.palette.primary.main}, ${n.palette.secondary.main})`,color:"white"},children:[t.jsx(O,{sx:{fontSize:48,mb:2}}),t.jsx(d,{variant:"h5",fontWeight:600,children:"Add Transaction"}),t.jsx(d,{variant:"body2",sx:{opacity:.9,mt:1},children:"Enter transaction details and confirm to add to the system"})]}),t.jsxs(x,{sx:{p:4},children:[!1,t.jsxs(x,{sx:{mb:4},children:[t.jsxs(d,{variant:"h6",color:"primary.main",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(k,{}),"Account Identification",t.jsx(U,{title:"Enter either Account # (11 digits) or Card # (16 digits)",children:t.jsx(z,{size:"small",children:t.jsx(K,{fontSize:"small"})})})]}),t.jsxs(o,{container:!0,spacing:3,children:[t.jsxs(o,{item:!0,xs:12,md:6,children:[c("accountId","Enter Acct #",{placeholder:"11111111111",inputProps:{maxLength:11},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(k,{color:"primary"})})}}),!1]}),t.jsxs(o,{item:!0,xs:12,md:6,children:[c("cardNumber","Card #",{placeholder:"4111111111111111",inputProps:{maxLength:16},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(rt,{color:"primary"})})}}),!1]})]}),t.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Enter either Account # (11 digits) or Card # (16 digits) - both are not required"})]}),t.jsx(w,{sx:{my:3}}),t.jsxs(x,{sx:{mb:4},children:[t.jsx(d,{variant:"h6",color:"primary.main",gutterBottom:!0,children:"Transaction Details"}),t.jsxs(o,{container:!0,spacing:3,children:[t.jsxs(o,{item:!0,xs:12,md:4,children:[c("transactionTypeCode","Type CD",{placeholder:"01",inputProps:{maxLength:2},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(et,{color:"primary"})})}}),!1]}),t.jsxs(o,{item:!0,xs:12,md:4,children:[c("transactionCategoryCode","Category CD",{placeholder:"5411",inputProps:{maxLength:4}}),!1]}),t.jsxs(o,{item:!0,xs:12,md:4,children:[c("transactionSource","Source",{placeholder:"ONLINE",inputProps:{maxLength:10},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(nt,{color:"primary"})})}}),!1]}),t.jsx(o,{item:!0,xs:12,children:c("transactionDescription","Description",{placeholder:"Transaction description",inputProps:{maxLength:60},multiline:!0,rows:2,InputProps:{startAdornment:t.jsx(m,{position:"start",sx:{alignSelf:"flex-start",mt:1},children:t.jsx(ot,{color:"primary"})})}})}),t.jsxs(o,{item:!0,xs:12,md:4,children:[c("transactionAmount","Amount",{placeholder:"-99999999.99",inputProps:{maxLength:12},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(O,{color:"primary"})})}}),t.jsx(d,{variant:"caption",color:"text.secondary",children:"Format: -99999999.99 (negative for debits)"}),!1]}),t.jsxs(o,{item:!0,xs:12,md:4,children:[c("originalDate","Orig Date",{type:"date",InputLabelProps:{shrink:!0},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(F,{color:"primary"})})}}),t.jsx(d,{variant:"caption",color:"text.secondary",children:"YYYY-MM-DD"}),!1]}),t.jsxs(o,{item:!0,xs:12,md:4,children:[c("processDate","Proc Date",{type:"date",InputLabelProps:{shrink:!0},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(F,{color:"primary"})})}}),t.jsx(d,{variant:"caption",color:"text.secondary",children:"YYYY-MM-DD"}),!1]})]})]}),t.jsx(w,{sx:{my:3}}),t.jsxs(x,{sx:{mb:4},children:[t.jsxs(d,{variant:"h6",color:"primary.main",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(V,{}),"Merchant Information"]}),t.jsxs(o,{container:!0,spacing:3,children:[t.jsxs(o,{item:!0,xs:12,md:6,children:[c("merchantId","Merchant ID",{placeholder:"987654321",inputProps:{maxLength:9},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(st,{color:"primary"})})}}),!1]}),t.jsxs(o,{item:!0,xs:12,md:6,children:[c("merchantName","Merchant Name",{placeholder:"MERCHANT NAME",inputProps:{maxLength:30}}),!1]}),t.jsxs(o,{item:!0,xs:12,md:6,children:[c("merchantCity","Merchant City",{placeholder:"CITY NAME",inputProps:{maxLength:25},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(it,{color:"primary"})})}}),!1]}),t.jsxs(o,{item:!0,xs:12,md:6,children:[c("merchantZip","Merchant Zip",{placeholder:"12345",inputProps:{maxLength:10},InputProps:{startAdornment:t.jsx(m,{position:"start",children:t.jsx(ct,{color:"primary"})})}}),!1]})]})]}),I&&t.jsxs(x,{sx:{mb:4},children:[t.jsx(S,{severity:"warning",sx:{mb:2},icon:t.jsx(X,{}),children:"You are about to add this transaction. Please confirm:"}),t.jsxs(o,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(o,{item:!0,children:t.jsx(d,{variant:"body1",color:"primary.main",fontWeight:600,children:"Confirm:"})}),t.jsx(o,{item:!0,children:c("confirmation","",{placeholder:"Y/N",inputProps:{maxLength:1,style:{textAlign:"center",textTransform:"uppercase"}},sx:{width:80}})}),t.jsx(o,{item:!0,children:t.jsx(d,{variant:"caption",color:"text.secondary",children:"(Y/N)"})}),!1]})]}),a&&t.jsx(S,{severity:"error",sx:{mb:3,borderRadius:2},children:a}),t.jsxs(J,{direction:"row",spacing:2,justifyContent:"center",flexWrap:"wrap",children:[t.jsx(M,{variant:"contained",onClick:i,disabled:h,startIcon:h?t.jsx(O,{}):I?t.jsx(Q,{}):t.jsx(_,{}),sx:{borderRadius:2,px:3},children:h?"Processing...":I?"Confirm & Add":"Continue"}),t.jsx(M,{variant:"outlined",onClick:N,disabled:h,startIcon:t.jsx(q,{}),sx:{borderRadius:2,px:3},children:"F4 = Clear"}),B,t.jsx(M,{variant:"outlined",color:"error",onClick:E,disabled:h,startIcon:t.jsx(tt,{}),sx:{borderRadius:2,px:3},children:"F3 = Exit"})]})]}),t.jsxs(x,{sx:{p:2,bgcolor:P(n.palette.grey[100],.5),borderTop:`1px solid ${n.palette.divider}`,textAlign:"center"},children:[t.jsx(d,{variant:"body2",color:"text.secondary",children:"ENTER = Continue â€¢ F3 = Back â€¢ F4 = Clear â€¢ F5 = Copy Last Tran."}),!1]})]})]})})}function jt(){Y();const[C,u]=s.useState(null),[n,l]=s.useState(null),f=g=>{u(`Transaction added successfully. Your Tran ID is ${g}.`)},D=g=>{l(g)};return t.jsxs(t.Fragment,{children:[t.jsx(ut,{onSuccess:f,onError:D}),t.jsx(Z,{open:!!C,autoHideDuration:6e3,onClose:()=>u(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(S,{onClose:()=>u(null),severity:"success",variant:"filled",sx:{width:"100%"},children:C})}),t.jsx(Z,{open:!!n,autoHideDuration:6e3,onClose:()=>l(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(S,{onClose:()=>l(null),severity:"error",variant:"filled",sx:{width:"100%"},children:n})})]})}export{jt as default};
