import{u as Q,j as e,a as X,B as f,P as _,g as E,b as A,a3 as ee,i,k as P,h as se,d as k,G as te,A as U,v as D,a4 as ae,a5 as re,a6 as ne,N as d,U as W,W as O,z as ie,D as M,S as R,a7 as Y,l as le,a8 as $,R as oe,K as de,y as ce,a9 as ue,aa as me,ab as xe,ac as pe,ad as he}from"./mui-bVcw8cZ8.js";import{r as n}from"./vendor-BPyidg2q.js";import{S as ge}from"./SystemHeader-DB4NlgIL.js";import{L as be,g as B}from"./index-85Pf7yId.js";import{u as K}from"./useApi-EeZ7am_M.js";import{u as je}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";function fe({onSearch:x,onUpdate:h,onExit:C,accountData:t,hasChanges:u=!1,loading:p=!1,error:I,onDataChange:b,onReset:v}){const g=Q(),[j,y]=n.useState(""),[w,L]=n.useState(null),[N,r]=n.useState(!1),[a,S]=n.useState(!1),[m,T]=n.useState({}),G=n.useCallback(s=>{const c=s.target.value;y(c),L(null)},[]),H=n.useCallback(s=>{if(s.preventDefault(),!j.trim()){L("Account number not provided");return}x({accountId:j}),S(!1)},[j,x]),l=n.useCallback((s,c)=>{if(!b||!t)return;const o={...m};switch(s){case"creditLimit":case"cashCreditLimit":case"currentBalance":c&&isNaN(Number(c))?o[s]="Must be a valid number":delete o[s];break;case"activeStatus":c&&!["Y","N"].includes(c)?o[s]="Must be Y or N":delete o[s];break;case"zipCode":c&&!/^\d{5}(-\d{4})?$/.test(c)?o[s]="Invalid ZIP code format":delete o[s];break}T(o),b({[s]:c})},[b,t,m]),z=n.useCallback(()=>{!t||Object.keys(m).length>0||r(!0)},[t,m]),J=n.useCallback(()=>{t&&(h(t),r(!1),S(!1))},[t,h]),F=n.useCallback(()=>{v?.(),T({}),S(!1)},[v]),Z=n.useCallback(s=>{s.key==="F3"||s.key==="Escape"?(s.preventDefault(),C?.()):s.key==="F5"&&t&&u?(s.preventDefault(),z()):s.key==="F12"&&(s.preventDefault(),F())},[C,t,u,z,F]);n.useCallback(s=>s==null?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s),[]),n.useCallback(s=>{if(!s)return"";try{return new Date(s).toLocaleDateString("en-US")}catch{return s}},[]);const V=s=>{switch(s){case"Y":return"success";case"N":return"error";default:return"default"}},q=s=>{switch(s){case"Y":return"Active";case"N":return"Inactive";default:return"Unknown"}};return e.jsx(X,{maxWidth:"xl",sx:{py:3},children:e.jsxs(f,{onKeyDown:Z,tabIndex:-1,children:[e.jsx(ge,{transactionId:"CAUP",programName:"COACTUPC",title:"CardDemo - Account Update",subtitle:"Update Account Information"}),e.jsxs(_,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${E(g.palette.background.paper,.9)}, ${E(g.palette.background.default,.1)})`},children:[e.jsx(f,{sx:{p:3,textAlign:"center",background:`linear-gradient(135deg, ${g.palette.primary.main}, ${g.palette.secondary.main})`,color:"white"},children:e.jsxs(A,{variant:"h5",fontWeight:600,children:[e.jsx(ee,{sx:{mr:1,verticalAlign:"middle"}}),"Update Account"]})}),e.jsxs(f,{sx:{p:3},children:[e.jsxs(f,{component:"form",onSubmit:H,sx:{display:"flex",alignItems:"center",gap:2,justifyContent:"center",flexWrap:"wrap",mb:3},children:[e.jsx(A,{variant:"body1",color:"primary.main",fontWeight:600,children:"Account Number:"}),e.jsx(i,{value:j,onChange:G,placeholder:"11111111111",size:"medium",disabled:p,error:!!w,helperText:w,inputProps:{maxLength:11,style:{textAlign:"center",fontSize:"1.1rem",fontWeight:600}},InputProps:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(se,{color:"primary"})})},sx:{width:200}}),e.jsx(k,{type:"submit",variant:"contained",disabled:p,startIcon:p?e.jsx(be,{size:20}):e.jsx(te,{}),sx:{borderRadius:2,px:3,fontWeight:600},children:p?"Searching...":"Search"})]}),I&&e.jsx(U,{severity:"error",sx:{mb:3,borderRadius:2},children:I}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(f,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(D,{label:q(t.activeStatus),color:V(t.activeStatus),variant:"filled",sx:{fontWeight:600}}),u&&e.jsx(D,{label:"Unsaved Changes",color:"warning",variant:"outlined",icon:e.jsx(ae,{}),sx:{fontWeight:600}})]}),e.jsx(re,{control:e.jsx(ne,{checked:a,onChange:s=>S(s.target.checked),color:"primary"}),label:"Edit Mode"})]}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,lg:6,children:e.jsx(W,{elevation:1,children:e.jsxs(O,{children:[e.jsxs(A,{variant:"h6",gutterBottom:!0,color:"primary.main",children:[e.jsx(ie,{sx:{mr:1,verticalAlign:"middle"}}),"Account Information"]}),e.jsx(M,{sx:{mb:2}}),e.jsxs(R,{spacing:2,children:[e.jsxs(i,{label:"Account Status",select:!0,value:t.activeStatus||"",onChange:s=>l("activeStatus",s.target.value),disabled:!a,error:!!m.activeStatus,helperText:m.activeStatus,size:"small",fullWidth:!0,children:[e.jsx(Y,{value:"Y",children:"Y - Active"}),e.jsx(Y,{value:"N",children:"N - Inactive"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Open Year",value:t.openDate?new Date(t.openDate).getFullYear():"",onChange:s=>{const c=s.target.value;if(t.openDate){const o=new Date(t.openDate);o.setFullYear(parseInt(c)||o.getFullYear()),l("openDate",o.toISOString().split("T")[0])}},disabled:!a,size:"small",type:"number"})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Open Month",value:t.openDate?new Date(t.openDate).getMonth()+1:"",onChange:s=>{const c=parseInt(s.target.value)-1;if(t.openDate){const o=new Date(t.openDate);o.setMonth(c),l("openDate",o.toISOString().split("T")[0])}},disabled:!a,size:"small",type:"number",inputProps:{min:1,max:12}})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Open Day",value:t.openDate?new Date(t.openDate).getDate():"",onChange:s=>{const c=parseInt(s.target.value);if(t.openDate){const o=new Date(t.openDate);o.setDate(c),l("openDate",o.toISOString().split("T")[0])}},disabled:!a,size:"small",type:"number",inputProps:{min:1,max:31}})})]}),e.jsx(i,{label:"Credit Limit",value:t.creditLimit||"",onChange:s=>l("creditLimit",parseFloat(s.target.value)||0),disabled:!a,error:!!m.creditLimit,helperText:m.creditLimit,size:"small",type:"number",InputProps:{startAdornment:e.jsx(P,{position:"start",children:"$"})}}),e.jsx(i,{label:"Cash Credit Limit",value:t.cashCreditLimit||"",onChange:s=>l("cashCreditLimit",parseFloat(s.target.value)||0),disabled:!a,error:!!m.cashCreditLimit,helperText:m.cashCreditLimit,size:"small",type:"number",InputProps:{startAdornment:e.jsx(P,{position:"start",children:"$"})}}),e.jsx(i,{label:"Account Group",value:t.groupId||"",onChange:s=>l("groupId",s.target.value),disabled:!a,size:"small"})]})]})})}),e.jsx(d,{item:!0,xs:12,lg:6,children:e.jsx(W,{elevation:1,children:e.jsxs(O,{children:[e.jsxs(A,{variant:"h6",gutterBottom:!0,color:"primary.main",children:[e.jsx(le,{sx:{mr:1,verticalAlign:"middle"}}),"Customer Information"]}),e.jsx(M,{sx:{mb:2}}),e.jsxs(R,{spacing:2,children:[e.jsx(i,{label:"Customer ID",value:t.customerId||"",disabled:!0,size:"small"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"First Name",value:t.firstName||"",onChange:s=>l("firstName",s.target.value),disabled:!a,size:"small"})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Middle Name",value:t.middleName||"",onChange:s=>l("middleName",s.target.value),disabled:!a,size:"small"})}),e.jsx(d,{item:!0,xs:4,children:e.jsx(i,{label:"Last Name",value:t.lastName||"",onChange:s=>l("lastName",s.target.value),disabled:!a,size:"small"})})]}),e.jsx(i,{label:"Address Line 1",value:t.addressLine1||"",onChange:s=>l("addressLine1",s.target.value),disabled:!a,size:"small"}),e.jsx(i,{label:"Address Line 2",value:t.addressLine2||"",onChange:s=>l("addressLine2",s.target.value),disabled:!a,size:"small"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"State",value:t.stateCode||"",onChange:s=>l("stateCode",s.target.value),disabled:!a,size:"small",inputProps:{maxLength:2}})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"ZIP Code",value:t.zipCode||"",onChange:s=>l("zipCode",s.target.value),disabled:!a,error:!!m.zipCode,helperText:m.zipCode,size:"small"})})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"Phone 1",value:t.phoneNumber1||"",onChange:s=>l("phoneNumber1",s.target.value),disabled:!a,size:"small"})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(i,{label:"Phone 2",value:t.phoneNumber2||"",onChange:s=>l("phoneNumber2",s.target.value),disabled:!a,size:"small"})})]}),e.jsx(i,{label:"FICO Score",value:t.ficoScore||"",onChange:s=>l("ficoScore",parseInt(s.target.value)||0),disabled:!a,size:"small",type:"number",inputProps:{min:300,max:850}})]})]})})})]}),a&&e.jsxs(f,{sx:{mt:3,display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(k,{variant:"contained",color:"primary",startIcon:e.jsx($,{}),onClick:z,disabled:!u||Object.keys(m).length>0,sx:{borderRadius:2,px:3},children:"Save Changes"}),e.jsx(k,{variant:"outlined",startIcon:e.jsx(oe,{}),onClick:F,disabled:!u,sx:{borderRadius:2,px:3},children:"Reset"})]})]})]}),e.jsx(f,{sx:{p:2,bgcolor:E(g.palette.grey[100],.5),borderTop:`1px solid ${g.palette.divider}`},children:e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsxs(A,{variant:"body2",color:"text.secondary",children:[e.jsx(de,{sx:{fontSize:16,mr:.5,verticalAlign:"middle"}}),"ENTER = Search • F5 = Save • F12 = Cancel"]}),e.jsx(k,{variant:"outlined",size:"small",startIcon:e.jsx(ce,{}),onClick:C,disabled:p,sx:{borderRadius:2},children:"F3 = Exit"})]})})]}),e.jsxs(ue,{open:N,onClose:()=>r(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(me,{children:[e.jsx(xe,{color:"success",sx:{mr:1,verticalAlign:"middle"}}),"Confirm Update"]}),e.jsxs(pe,{children:[e.jsxs(A,{children:["Are you sure you want to save the changes to account ",t?.accountId,"?"]}),u&&e.jsx(U,{severity:"info",sx:{mt:2},children:"This will update both account and customer information in the database."})]}),e.jsxs(he,{children:[e.jsx(k,{onClick:()=>r(!1),children:"Cancel"}),e.jsx(k,{onClick:J,variant:"contained",startIcon:e.jsx($,{}),children:"Confirm Save"})]})]})]})})}function Ce(){const[x,h]=n.useState(null),[C,t]=n.useState(!1),[u,p]=n.useState(null),{mutate:I,loading:b,error:v}=K(async r=>{const a=parseInt(r.accountId,10);return await B.get(`/accounts/${a}`)},{onSuccess:r=>{h(r),p(r),t(!1)},onError:r=>{console.error("Error searching account:",r),h(null),p(null)}}),{mutate:g,loading:j,error:y}=K(async r=>await B.put(`/accounts/${r.accountId}`,r),{onSuccess:r=>{r.success&&r.data&&(h(r.data),p(r.data),t(!1))},onError:r=>{console.error("Error updating account:",r)}}),w=n.useCallback(r=>{if(!x)return;const a={...x,...r};h(a);const S=u?JSON.stringify(a)!==JSON.stringify(u):!1;t(S)},[x,u]),L=n.useCallback(()=>{u&&(h(u),t(!1))},[u]),N=n.useCallback(()=>{h(null),p(null),t(!1)},[]);return{accountData:x,hasChanges:C,searchAccount:I,updateAccount:g,updateLocalData:w,resetForm:L,clearData:N,searchLoading:b,updateLoading:j,searchError:v,updateError:y,loading:b||j,error:v||y}}function Le(){const x=je(),{accountData:h,hasChanges:C,searchAccount:t,updateAccount:u,updateLocalData:p,resetForm:I,clearData:b,loading:v,error:g}=Ce();n.useEffect(()=>{if(!localStorage.getItem("userRole")){x("/login");return}b()},[x,b]);const j=()=>{const y=localStorage.getItem("userRole");x(y==="admin"?"/menu/admin":"/menu/main")};return e.jsx(fe,{onSearch:t,onUpdate:u,onExit:j,accountData:h,hasChanges:C,loading:v,error:g,onDataChange:p,onReset:I})}export{Le as default};
