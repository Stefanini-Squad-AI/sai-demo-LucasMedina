import{u as Y,j as e,a as _,B as m,P as G,g as b,b as U,l as L,i as H,v as B,af as V,ag as J,ah as Q,ai as D,aj as l,ak as X,aq as M,as as K,a7 as T,y as O,A as Z,S as R,d as w,K as q,al as ee,am as re,o as se}from"./mui-bVcw8cZ8.js";import{r as n}from"./vendor-BPyidg2q.js";import{S as te}from"./SystemHeader-DB4NlgIL.js";import{a as ae}from"./useApi-EeZ7am_M.js";import{g as ne,L as le}from"./index-85Pf7yId.js";import{u as ie}from"./router-DEfLtG0k.js";import"./redux-B6kvt0Aa.js";const F=t=>t==="R"?"U":t;function oe({users:t,loading:u,error:g,pagination:i,searchCriteria:o,onSearch:f,onUserAction:y,onPageChange:p,onExit:v}){const a=Y(),[c,k]=n.useState(o||""),[j,x]=n.useState({}),C=n.useCallback(s=>{s.preventDefault();const d=c.trim()||void 0;f({searchUserId:d,page:1,limit:10})},[c,f]),S=n.useCallback((s,d)=>{x(r=>({...r,[s]:d}))},[]),I=n.useCallback(()=>{const s=Object.entries(j).filter(([r,h])=>h!=="");if(s.length===0){C({preventDefault:()=>{}});return}const d=s[0];if(d){const[r,h]=d;(h==="U"||h==="D")&&(y({userId:r,action:h}),x({}))}},[j,C,y]),N=n.useCallback(s=>{switch(s.key){case"Enter":s.preventDefault(),I();break;case"F3":case"Escape":s.preventDefault(),v();break;case"F7":s.preventDefault(),i.hasPrev&&p(i.page-1);break;case"F8":s.preventDefault(),i.hasNext&&p(i.page+1);break}},[I,v,p,i]);n.useEffect(()=>{k(o||"")},[o]);const P=s=>F(s)==="A"?"Admin":"User",W=s=>F(s)==="A"?"error":"primary",A=s=>F(s)==="A"?e.jsx(se,{}):e.jsx(L,{});return e.jsx(_,{maxWidth:"xl",sx:{py:3},children:e.jsxs(m,{onKeyDown:N,tabIndex:-1,children:[e.jsx(te,{transactionId:"CU00",programName:"COUSR00C",title:"List Users",subtitle:"User Security Management"}),e.jsxs(G,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${b(a.palette.background.paper,.9)}, ${b(a.palette.background.default,.1)})`},children:[e.jsxs(m,{sx:{p:3,background:`linear-gradient(135deg, ${a.palette.primary.main}, ${a.palette.secondary.main})`,color:"white"},children:[e.jsxs(U,{variant:"h5",fontWeight:600,gutterBottom:!0,children:[e.jsx(L,{sx:{mr:1,verticalAlign:"middle"}}),"List Users"]}),e.jsxs(m,{component:"form",onSubmit:C,sx:{display:"flex",alignItems:"center",gap:2,mt:2,flexWrap:"wrap"},children:[e.jsx(U,{variant:"body1",fontWeight:500,children:"Search User ID:"}),e.jsx(H,{value:c,onChange:s=>k(s.target.value.toUpperCase()),placeholder:"Enter User ID",size:"small",disabled:u,inputProps:{maxLength:8,style:{textAlign:"center",fontSize:"1rem",fontWeight:600,color:a.palette.common.black}},sx:{width:150,bgcolor:"white",borderRadius:1,"& .MuiOutlinedInput-root":{"&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:a.palette.secondary.main,borderWidth:2}}}}})]})]}),e.jsxs(m,{sx:{px:3,py:2,bgcolor:b(a.palette.info.main,.1),borderBottom:`1px solid ${a.palette.divider}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(U,{variant:"body2",color:"text.secondary",children:[o&&e.jsxs(e.Fragment,{children:["Search: ",e.jsx("strong",{children:o})," â€¢ "]}),"Showing ",t.length," users"]}),e.jsx(B,{label:`Page: ${i.page}`,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(V,{children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(D,{sx:{bgcolor:b(a.palette.grey[100],.5)},children:[e.jsx(l,{sx:{fontWeight:600,minWidth:100},children:"Selection"}),e.jsx(l,{sx:{fontWeight:600,minWidth:120},children:"User ID"}),e.jsx(l,{sx:{fontWeight:600,minWidth:200},children:"First Name"}),e.jsx(l,{sx:{fontWeight:600,minWidth:200},children:"Last Name"}),e.jsx(l,{sx:{fontWeight:600,minWidth:100},children:"Type"})]})}),e.jsxs(X,{children:[e.jsxs(D,{children:[e.jsx(l,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"---------"}),e.jsx(l,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"--------"}),e.jsx(l,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"--------------------"}),e.jsx(l,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"--------------------"}),e.jsx(l,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"----"})]}),t.map(s=>e.jsxs(D,{sx:{"&:hover":{bgcolor:b(a.palette.primary.main,.04)},"&:nth-of-type(even)":{bgcolor:b(a.palette.grey[50],.5)}},children:[e.jsx(l,{children:e.jsx(M,{size:"small",sx:{minWidth:90},children:e.jsxs(K,{value:j[s.userId]||"",onChange:d=>S(s.userId,d.target.value),displayEmpty:!0,disabled:u,sx:{"& .MuiSelect-select":{textAlign:"center",fontWeight:600}},children:[e.jsx(T,{value:"",children:e.jsx("em",{children:"Select"})}),e.jsx(T,{value:"U",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{fontSize:"small"}),"U - Update"]})}),e.jsx(T,{value:"D",children:e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{fontSize:"small"}),"D - Delete"]})})]})})}),e.jsx(l,{children:e.jsx(U,{variant:"body2",fontWeight:600,color:"primary.main",children:s.userId})}),e.jsx(l,{children:e.jsx(U,{variant:"body2",children:s.firstName})}),e.jsx(l,{children:e.jsx(U,{variant:"body2",children:s.lastName})}),e.jsx(l,{children:e.jsx(B,{label:P(s.userType),size:"small",color:W(s.userType),icon:A(s.userType),variant:"outlined"})})]},s.userId)),Array.from({length:Math.max(0,10-t.length)}).map((s,d)=>e.jsxs(D,{children:[e.jsx(l,{children:e.jsx(M,{size:"small",sx:{minWidth:90},children:e.jsx(K,{value:"",disabled:!0,displayEmpty:!0,children:e.jsx(T,{value:"",children:e.jsx("em",{children:"Select"})})})})}),e.jsx(l,{children:"Â "}),e.jsx(l,{children:"Â "}),e.jsx(l,{children:"Â "}),e.jsx(l,{children:"Â "})]},`empty-${d}`))]})]})}),g&&e.jsx(m,{sx:{p:3},children:e.jsx(Z,{severity:"error",sx:{borderRadius:2},children:g})}),e.jsx(m,{sx:{px:3,py:2,bgcolor:b(a.palette.grey[100],.3),borderTop:`1px solid ${a.palette.divider}`},children:e.jsx(U,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",fontWeight:500},children:"Select 'U' to Update or 'D' to Delete a User from the list"})}),e.jsx(m,{sx:{p:3,bgcolor:b(a.palette.grey[100],.5),borderTop:`1px solid ${a.palette.divider}`},children:e.jsxs(R,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsx(R,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(w,{variant:"contained",size:"small",startIcon:e.jsx(q,{}),onClick:I,disabled:u,color:"primary",children:"ENTER = Continue"})}),e.jsxs(R,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(w,{variant:"outlined",size:"small",startIcon:e.jsx(ee,{}),onClick:()=>p(i.page-1),disabled:!i.hasPrev||u,children:"F7 = Backward"}),e.jsx(w,{variant:"outlined",size:"small",endIcon:e.jsx(re,{}),onClick:()=>p(i.page+1),disabled:!i.hasNext||u,children:"F8 = Forward"}),e.jsx(w,{variant:"outlined",size:"small",startIcon:e.jsx(O,{}),onClick:v,disabled:u,children:"F3 = Back"})]})]})})]})]})})}function ce(t={}){const u=ie(),[g,i]=n.useState(""),[o,f]=n.useState(1),[y,p]=n.useState(!1),v=!0,a=n.useRef();a.current||(a.current=async r=>{console.log("ðŸ” Fetching users with:",{useMocks:v,request:r});{const h=new URLSearchParams;h.append("page",r.page.toString()),h.append("limit",r.limit.toString()),r.searchUserId&&h.append("searchUserId",r.searchUserId);const E=`/users/security?${h.toString()}`;return console.log("ðŸ” Mock endpoint:",E),ne.get(E)}});const{data:c,loading:k,error:j,execute:x}=ae(()=>a.current({searchUserId:g||void 0,page:o,limit:10}),{immediate:!1,...t.onError&&{onError:t.onError}});n.useEffect(()=>{y||(console.log("ðŸš€ Initial load of users"),x(),p(!0))},[y,x]);const C=n.useCallback(r=>{console.log("ðŸ” Search triggered:",r),i(r.searchUserId||""),f(r.page),setTimeout(()=>{x()},0)},[x]),S=n.useCallback(r=>{if(console.log("ðŸ“„ Page change triggered:",r),r<1){t.onError?.("You are already at the top of the page...");return}const h=c?.pagination?.totalPages||1;if(r>h&&!c?.pagination?.hasNext){t.onError?.("You are already at the bottom of the page...");return}f(r),setTimeout(()=>{x()},0)},[x,c?.pagination,t]),I=n.useCallback(r=>{if(console.log("ðŸŽ¯ Processing user action:",r),!r.action||r.action!=="U"&&r.action!=="D"){t.onError?.("Invalid selection. Valid values are U and D");return}if(!r.userId||r.userId.trim()===""){t.onError?.("User ID cannot be empty");return}switch(r.action.toUpperCase()){case"U":console.log("ðŸ”„ Navigating to update user:",r.userId),u(`/admin/users/update?userId=${r.userId}`);break;case"D":console.log("ðŸ—‘ï¸ Navigating to delete user:",r.userId),u(`/admin/users/delete?userId=${r.userId}`);break;default:t.onError?.("Invalid selection. Valid values are U and D");break}},[u,t]),N=n.useCallback(()=>{console.log("ðŸšª Exiting to admin menu"),u("/menu/admin")},[u]),P=n.useCallback(()=>{console.log("ðŸ”„ Refreshing user list"),x()},[x]),W=n.useCallback(()=>{console.log("ðŸ§¹ Clearing search"),i(""),f(1),setTimeout(()=>{x()},0)},[x]),A=n.useCallback(()=>{console.log("â¬…ï¸ Going to previous page"),o>1?S(o-1):t.onError?.("You are already at the top of the page...")},[o,S,t]),s=n.useCallback(()=>{console.log("âž¡ï¸ Going to next page"),c?.pagination?.hasNext?S(o+1):t.onError?.("You are already at the bottom of the page...")},[o,S,c?.pagination,t]),d=n.useCallback(r=>{console.log("âŽ Processing ENTER key with selections:",r);const h=Object.entries(r).filter(([$,z])=>z!=="");if(h.length===0)return console.log("ðŸ” No selection found, treating as search"),!1;const E=h[0];if(E){const[$,z]=E;if(z==="U"||z==="D")return I({userId:$,action:z}),!0}return!1},[I]);return{users:c?.users||[],pagination:c?.pagination||{page:1,limit:10,total:0,totalPages:0,hasNext:!1,hasPrev:!1},searchCriteria:g,loading:k,error:j,handleSearch:C,handlePageChange:S,handleUserAction:I,handleExit:N,handlePreviousPage:A,handleNextPage:s,handleEnterKey:d,refresh:P,clearSearch:W,isFirstPage:o===1,isLastPage:!c?.pagination?.hasNext,hasUsers:(c?.users?.length||0)>0,currentPage:o,validateSelection:n.useCallback(r=>r==="U"||r==="D",[]),getStatusMessage:n.useCallback(()=>k?"Loading users...":j||(c?.users?.length?null:g?"No users found matching your search criteria":"No users available"),[k,j,c?.users?.length,g])}}function fe(){const{users:t,pagination:u,searchCriteria:g,loading:i,error:o,handleSearch:f,handlePageChange:y,handleUserAction:p,handleExit:v}=ce({onError:a=>{console.error("User list error:",a)},onUserAction:a=>{console.log("User action processed:",a)}});return i&&t.length===0?e.jsx(le,{}):e.jsx(oe,{users:t,pagination:u,searchCriteria:g,loading:i,error:o,onSearch:f,onPageChange:y,onUserAction:p,onExit:v})}export{fe as default};
