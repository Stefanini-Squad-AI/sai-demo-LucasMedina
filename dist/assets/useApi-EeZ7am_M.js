import{r as t}from"./vendor-BPyidg2q.js";import{A as R}from"./index-85Pf7yId.js";function A(d,E={}){const{immediate:b=!0,onSuccess:u,onError:g,retries:a=0,retryDelay:n=1e3}=E,[m,i]=t.useState({data:null,loading:!1,error:null}),l=t.useRef(null),e=t.useRef(0),r=t.useRef(!1),f=t.useCallback(async()=>{if(r.current){console.log("âš ï¸ API call already in progress, skipping");return}r.current=!0,l.current&&l.current.abort(),l.current=new AbortController,e.current=0;const w=async()=>{i(o=>({...o,loading:!0,error:null}));try{const o=await d();if(o.success&&o.data)i({data:o.data,loading:!1,error:null}),u?.(o.data);else{const p=o.error||"Unknown error occurred";i({data:null,loading:!1,error:p}),g?.(p)}}catch(o){if(o instanceof Error&&o.name==="AbortError")return;const p=o instanceof R?o.message:"Network error occurred";if(e.current<a){e.current++,setTimeout(w,n*e.current);return}i({data:null,loading:!1,error:p}),g?.(p)}finally{r.current=!1}};await w()},[d,u,g,a,n]),c=t.useCallback(()=>{l.current&&l.current.abort(),r.current=!1,i({data:null,loading:!1,error:null})},[]),s=t.useRef(!1);return t.useEffect(()=>(b&&!s.current&&(s.current=!0,f()),()=>{l.current&&l.current.abort(),r.current=!1}),[]),{...m,execute:f,reset:c}}function M(d,E={}){const{onSuccess:b,onError:u}=E,[g,a]=t.useState({data:null,loading:!1,error:null}),n=t.useRef(null),m=t.useCallback(async l=>{n.current&&n.current.abort(),n.current=new AbortController,a(e=>({...e,loading:!0,error:null}));try{const e=await d(l);console.log("ðŸŽ¯ useMutation raw result:",e);let r=null,f=!1,c="";if(e&&typeof e=="object")if("success"in e&&e.success===!1)f=!0,c=e.errorMessage||e.error||"Request failed",console.log("âŒ Backend real error response:",c);else if("success"in e&&e.success===!0&&"data"in e){const s=e;s.data!==null&&s.data!==void 0?(r=s.data,console.log("âœ… MSW ApiResponse detected:",r)):(f=!0,c=s.error||"No data in successful response")}else"currentDate"in e&&"currentTime"in e&&"transactionId"in e?(r=e,console.log("âœ… Backend real Credit Card Update response:",r)):!("success"in e)||"success"in e&&typeof e.success!="boolean"?(r=e,console.log("âœ… Backend real AccountView response:",r)):(r=e,console.log("âœ… Default object response:",r));else r=e,console.log("âœ… Primitive response:",r);if(f)throw a({data:null,loading:!1,error:c}),u?.(c),new Error(c);if(r==null){const s="No valid data received from API";throw a({data:null,loading:!1,error:s}),u?.(s),new Error(s)}return a({data:r,loading:!1,error:null}),b?.(r),r}catch(e){if(e instanceof Error&&e.name==="AbortError")return;const r=e instanceof R||e instanceof Error?e.message:"Network error occurred";throw console.error("ðŸš¨ useMutation error:",r),a({data:null,loading:!1,error:r}),u?.(r),e}},[d,b,u]),i=t.useCallback(()=>{n.current&&n.current.abort(),a({data:null,loading:!1,error:null})},[]);return t.useEffect(()=>()=>{n.current&&n.current.abort()},[]),{...g,mutate:m,reset:i}}export{A as a,M as u};
