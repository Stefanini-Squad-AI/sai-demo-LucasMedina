import{u as K,j as e,a as V,B as h,P as q,g as S,b as C,l as F,i as E,d as N,G,D as H,S as w,k as J,I as Q,V as X,m as Y,aq as Z,ar as _,as as ee,a7 as A,o as se,A as ae,K as re,a8 as W,ae as te,y as ne}from"./mui-bVcw8cZ8.js";import{r as o}from"./vendor-BPyidg2q.js";import{S as ie}from"./SystemHeader-DB4NlgIL.js";import{u as le,d as oe}from"./router-DEfLtG0k.js";import{u as L}from"./useApi-EeZ7am_M.js";import{g as O,L as de}from"./index-85Pf7yId.js";import"./userApi-BJ-es0VP.js";import"./redux-B6kvt0Aa.js";function ce({formData:i,errors:n,loading:l,message:x,messageType:a,userData:f,onFormChange:u,onFetchUser:p,onSave:g,onSaveAndExit:d,onClear:y,onExit:c}){const r=K(),[b,j]=o.useState(!1),I=o.useCallback(t=>{t.key==="F3"?(t.preventDefault(),d()):t.key==="F4"?(t.preventDefault(),y()):t.key==="F5"?(t.preventDefault(),g()):(t.key==="F12"||t.key==="Escape")&&(t.preventDefault(),c())},[d,y,g,c]),T=o.useCallback(t=>{t.preventDefault(),p()},[p]),m=f!==null,k=m&&i.firstName&&i.lastName&&i.password&&i.userType;return e.jsx(V,{maxWidth:"lg",sx:{py:3},children:e.jsxs(h,{onKeyDown:I,tabIndex:-1,children:[e.jsx(ie,{transactionId:"CU02",programName:"COUSR02C",title:"Update User",subtitle:"User Security Management"}),e.jsxs(q,{elevation:2,sx:{borderRadius:3,overflow:"hidden",background:`linear-gradient(145deg, ${S(r.palette.background.paper,.9)}, ${S(r.palette.background.default,.1)})`},children:[e.jsx(h,{sx:{p:3,background:`linear-gradient(135deg, ${r.palette.primary.main}, ${r.palette.secondary.main})`,color:"white"},children:e.jsxs(C,{variant:"h5",fontWeight:600,gutterBottom:!0,children:[e.jsx(F,{sx:{mr:1,verticalAlign:"middle"}}),"Update User Information"]})}),e.jsx(h,{sx:{p:3,bgcolor:S(r.palette.info.main,.05)},children:e.jsxs(h,{component:"form",onSubmit:T,sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(C,{variant:"body1",fontWeight:600,color:"primary.main",children:"Enter User ID:"}),e.jsx(E,{value:i.userId,onChange:t=>u("userId",t.target.value.toUpperCase()),placeholder:"USER001",size:"small",disabled:l,error:!!n.userId,helperText:n.userId,inputProps:{maxLength:8,style:{textAlign:"center",fontSize:"1rem",fontWeight:600}},sx:{width:150,"& .MuiOutlinedInput-root":{bgcolor:"white","&:hover":{"& .MuiOutlinedInput-notchedOutline":{borderColor:r.palette.primary.main,borderWidth:2}}}}}),e.jsx(N,{type:"submit",variant:"contained",disabled:l||!i.userId.trim(),startIcon:e.jsx(G,{}),sx:{fontWeight:600},children:"Fetch User"})]})}),e.jsx(H,{}),e.jsx(h,{sx:{px:3,py:1,bgcolor:S(r.palette.warning.main,.1),borderTop:`3px solid ${r.palette.warning.main}`,borderBottom:`3px solid ${r.palette.warning.main}`},children:e.jsx(C,{variant:"body2",color:"warning.dark",fontWeight:600,textAlign:"center",children:"*".repeat(70)})}),e.jsx(h,{sx:{p:3},children:e.jsxs(w,{spacing:3,children:[e.jsxs(w,{direction:{xs:"column",md:"row"},spacing:3,children:[e.jsx(E,{label:"First Name",value:i.firstName,onChange:t=>u("firstName",t.target.value),disabled:l||!m,error:!!n.firstName,helperText:n.firstName,fullWidth:!0,inputProps:{maxLength:20},sx:{"& .MuiInputLabel-root":{color:r.palette.info.main,fontWeight:600}}}),e.jsx(E,{label:"Last Name",value:i.lastName,onChange:t=>u("lastName",t.target.value),disabled:l||!m,error:!!n.lastName,helperText:n.lastName,fullWidth:!0,inputProps:{maxLength:20},sx:{"& .MuiInputLabel-root":{color:r.palette.info.main,fontWeight:600}}})]}),e.jsxs(w,{direction:{xs:"column",md:"row"},spacing:3,children:[e.jsx(E,{label:"Password",type:b?"text":"password",value:i.password,onChange:t=>u("password",t.target.value),disabled:l||!m,error:!!n.password,helperText:n.password||"(8 Char)",inputProps:{maxLength:8},InputProps:{endAdornment:e.jsx(J,{position:"end",children:e.jsx(Q,{onClick:()=>j(!b),disabled:l||!m,edge:"end",children:b?e.jsx(X,{}):e.jsx(Y,{})})})},sx:{flex:1,"& .MuiInputLabel-root":{color:r.palette.info.main,fontWeight:600}}}),e.jsxs(Z,{sx:{flex:1},error:!!n.userType,disabled:l||!m,children:[e.jsx(_,{sx:{color:r.palette.info.main,fontWeight:600},children:"User Type"}),e.jsxs(ee,{value:i.userType,onChange:t=>u("userType",t.target.value),label:"User Type",children:[e.jsx(A,{value:"",children:e.jsx("em",{children:"Select Type"})}),e.jsx(A,{value:"A",children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{fontSize:"small"}),"A - Admin"]})}),e.jsx(A,{value:"U",children:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{fontSize:"small"}),"U - User"]})})]}),n.userType&&e.jsx(C,{variant:"caption",color:"error",sx:{mt:.5,ml:1.5},children:n.userType})]})]}),e.jsx(C,{variant:"body2",color:"text.secondary",textAlign:"center",children:"(A=Admin, U=User)"})]})}),x&&e.jsx(h,{sx:{px:3,pb:2},children:e.jsx(ae,{severity:a||"info",sx:{borderRadius:2},children:x})}),e.jsx(h,{sx:{p:3,bgcolor:S(r.palette.grey[100],.5),borderTop:`1px solid ${r.palette.divider}`},children:e.jsxs(w,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[e.jsxs(w,{direction:"row",spacing:1,flexWrap:"wrap",children:[e.jsx(N,{variant:"contained",startIcon:e.jsx(re,{}),onClick:p,disabled:l||!i.userId.trim(),size:"small",children:"ENTER = Fetch"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(W,{}),onClick:d,disabled:l||!k,color:"success",size:"small",children:"F3 = Save & Exit"})]}),e.jsxs(w,{direction:"row",spacing:1,flexWrap:"wrap",children:[e.jsx(N,{variant:"outlined",startIcon:e.jsx(te,{}),onClick:y,disabled:l,size:"small",children:"F4 = Clear"}),e.jsx(N,{variant:"contained",startIcon:e.jsx(W,{}),onClick:g,disabled:l||!k,color:"primary",size:"small",children:"F5 = Save"}),e.jsx(N,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:c,disabled:l,size:"small",children:"F12 = Cancel"})]})]})})]})]})})}function ue(i={}){const n=le(),[l]=oe(),x=l.get("userId")||"",[a,f]=o.useState({userId:x,firstName:"",lastName:"",password:"",userType:""}),[u,p]=o.useState({}),[g,d]=o.useState(null),[y,c]=o.useState(null),[r,b]=o.useState(null),j=!0,{mutate:I,loading:T}=L(async s=>{if(console.log("ðŸ” Fetching user:",{userId:s,useMocks:j}),j)return O.get(`/users/security/${s}`)},{onSuccess:s=>{console.log("âœ… User fetched successfully:",s),b(s),f(v=>({...v,firstName:s.firstName,lastName:s.lastName,password:s.password||"",userType:s.userType})),d("Press F5 key to save your updates ..."),c("info"),p({})},onError:s=>{console.error("âŒ Error fetching user:",s),b(null),f(v=>({...v,firstName:"",lastName:"",password:"",userType:""})),d(s),c("error"),i.onError?.(s)}}),{mutate:m,loading:k}=L(async s=>{if(console.log("ðŸ”„ Updating user:",{data:s,useMocks:j}),j)return O.put(`/users/security/${s.userId}`,s)},{onSuccess:s=>{console.log("âœ… User updated successfully:",s),d(`User ${a.userId} has been updated ...`),c("success"),i.onSuccess?.(`User ${a.userId} has been updated ...`)},onError:s=>{console.error("âŒ Error updating user:",s),d(s),c("error"),i.onError?.(s)}}),t=o.useCallback(()=>{const s={};return a.userId.trim()||(s.userId="User ID can NOT be empty..."),a.firstName.trim()||(s.firstName="First Name can NOT be empty..."),a.lastName.trim()||(s.lastName="Last Name can NOT be empty..."),a.password.trim()?a.password.length!==8&&(s.password="Password must be exactly 8 characters..."):s.password="Password can NOT be empty...",a.userType||(s.userType="User Type can NOT be empty..."),p(s),Object.keys(s).length===0},[a]),U=o.useCallback(()=>r?a.firstName!==r.firstName||a.lastName!==r.lastName||a.password!==(r.password||"")||a.userType!==r.userType:!1,[a,r]),M=o.useCallback((s,v)=>{f(P=>({...P,[s]:v})),u[s]&&p(P=>({...P,[s]:void 0}))},[u]),$=o.useCallback(()=>{if(!a.userId.trim()){p({userId:"User ID can NOT be empty..."}),d("User ID can NOT be empty..."),c("error");return}I(a.userId.trim())},[a.userId,I]),R=o.useCallback(()=>{if(!t()){d("Please correct the errors and try again..."),c("error");return}if(!U()){d("Please modify to update ..."),c("error");return}const s={userId:a.userId,firstName:a.firstName,lastName:a.lastName,password:a.password,userType:a.userType};m(s)},[t,U,a,m]),z=o.useCallback(()=>{if(!t()){d("Please correct the errors and try again..."),c("error");return}if(!U()){n("/admin/users/list");return}const s={userId:a.userId,firstName:a.firstName,lastName:a.lastName,password:a.password,userType:a.userType};m(s),setTimeout(()=>{n("/admin/users/list")},1500)},[t,U,a,m,n]),D=o.useCallback(()=>{f({userId:"",firstName:"",lastName:"",password:"",userType:""}),b(null),p({}),d(null),c(null)},[]),B=o.useCallback(()=>{n("/admin/users/list")},[n]);return o.useEffect(()=>{x&&!r&&!T&&(console.log("ðŸš€ Auto-fetching user from URL params:",x),I(x))},[x,r,T,I]),{formData:a,errors:u,loading:T||k,message:g,messageType:y,userData:r,handleFormChange:M,handleFetchUser:$,handleSave:R,handleSaveAndExit:z,handleClear:D,handleExit:B,hasChanges:U(),isValid:Object.keys(u).length===0}}function Ie(){const{formData:i,errors:n,loading:l,message:x,messageType:a,userData:f,handleFormChange:u,handleFetchUser:p,handleSave:g,handleSaveAndExit:d,handleClear:y,handleExit:c}=ue({onError:r=>{console.error("User update error:",r)},onSuccess:r=>{console.log("User update success:",r)}});return l&&!f?e.jsx(de,{}):e.jsx(ce,{formData:i,errors:n,loading:l,message:x,messageType:a,userData:f,onFormChange:u,onFetchUser:p,onSave:g,onSaveAndExit:d,onClear:y,onExit:c})}export{Ie as default};
